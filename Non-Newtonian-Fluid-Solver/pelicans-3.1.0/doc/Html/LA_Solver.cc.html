<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<html>
<head>
  <title>LA_Solver.cc</title>
  <link rel ="stylesheet" type="text/css" href="stylesheet.css" title="Style">
</head>
<script>
  function asd()
  {
    parent.document.title="LA_Solver.cc_PELICANS 17_03_2010 ";
  }
</script> 

<body onload="asd();">

<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<div id=navbar>
  <a name="navbar_top_firstrow"><!-- --></a>
  <div id=navbarapp>PELICANS 17_03_2010</div>
  <div id=navbarmenu>
    <a href="LApack-tree.html"><span>Tree</span></a>
    <a href="LA_Solver.html"><span>Class</span></a>
    <a href="LA_Solver.hh.html"><span>Header</span></a>
    <span class=selected>Implementation</span>
    <div id=navbarsub>
      <a href="index.html" target="_top">FRAMES :</a>
      <a href="LApack-tree.html" target="_top">: NO FRAMES</a>
    </div>
  </div>
</div>
<!-- ========== END OF NAVBAR ========== -->

<pre>
<font class="comment">/*
 *  Copyright 1995-2010 by IRSN
 *
 *  This software is an application framework, with a set of integrated
 *  reusable components, whose purpose is to simplify the task of developing
 *  softwares of numerical mathematics and scientific computing.
 *
 *  This software is governed by the CeCILL-C license under French law and
 *  abiding by the rules of distribution of free software. You can use, modify
 *  and/or redistribute the software under the terms of the CeCILL-C license
 *  as circulated by CEA, CNRS and INRIA at the following URL
 *  &quot;http://www.cecill.info&quot;.
 *
 *  As a counterpart to the access to the source code and rights to copy,
 *  modify and redistribute granted by the license, users are provided only
 *  with a limited warranty and the software's author, the holder of the
 *  economic rights, and the successive licensors have only limited liability.
 *
 *  In this respect, the user's attention is drawn to the risks associated
 *  with loading, using, modifying and/or developing or reproducing the
 *  software by the user in light of its specific status of free software,
 *  that may mean that it is complicated to manipulate, and that also
 *  therefore means that it is reserved for developers and experienced
 *  professionals having in-depth computer knowledge. Users are therefore
 *  encouraged to load and test the software's suitability as regards their
 *  requirements in conditions enabling the security of their systems and/or
 *  data to be ensured and, more generally, to use and operate it in the same
 *  conditions as regards security.
 *
 *  The fact that you are presently reading this means that you have had
 *  knowledge of the CeCILL-C license and that you accept its terms.
 */
</font><font class="text">
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">LA_Solver</font><font class="text">.hh&gt;

</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_Communicator</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_DistributedPartition</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_Error</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_Exec</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_ModuleExplorer</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_ObjectRegister</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_Root</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_System</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_Timer</font><font class="text">.hh&gt;

</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">LA_PreconditionedSolver</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">LA_SeqMatrix</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">LA_SeqVector</font><font class="text">.hh&gt;

</font><font class="kw2">#include</font><font class="text"> &lt;iostream&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;sstream&gt;

</font><font class="kw1">using</font><font class="text"> </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
</font><font class="kw1">using</font><font class="text"> </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> ;
</font><font class="kw1">using</font><font class="text"> </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">ostringstream</font><font class="text"> ;

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: is_registered( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text"> solver_name )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: is_registered&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( !solver_name.empty() ) ;
   </font><font class="kw1">return</font><font class="text">( plugins_map()-&gt;has( solver_name ) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_Solver</font><font class="text">*
</font><font class="kw3">LA_Solver</font><font class="text">:: make( </font><font class="kw3">PEL_Object</font><font class="text">* a_owner,
                  </font><font class="kw3">PEL_ModuleExplorer</font><font class="text"> </font><font class="kw1">const</font><font class="text">* exp )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: make&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( exp != 0 ) ;

   </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> name = exp-&gt;string_data( </font><font class="string">&quot;concrete_name&quot;</font><font class="text"> ) ;
   </font><font class="kw3">LA_Solver</font><font class="text"> </font><font class="kw1">const</font><font class="text">* proto =
      </font><font class="kw1">static_cast</font><font class="text">&lt;</font><font class="kw3">LA_Solver</font><font class="text"> </font><font class="kw1">const</font><font class="text">*&gt;(
         plugins_map()-&gt;item( name ) ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( proto-&gt;is_a_prototype() ) ;

   </font><font class="kw3">LA_Solver</font><font class="text">* result = proto-&gt;create_replica( a_owner, exp ) ;
   result-&gt;SOLVER_NAME = proto-&gt;SOLVER_NAME ;
   </font><font class="kw1">if</font><font class="text">( exp-&gt;has_entry( </font><font class="string">&quot;name&quot;</font><font class="text"> ) )
      result-&gt;SOLVER_NAME = exp-&gt;string_data( </font><font class="string">&quot;name&quot;</font><font class="text"> ) ;
   </font><font class="kw1">if</font><font class="text">( exp-&gt;has_entry( </font><font class="string">&quot;verbose&quot;</font><font class="text"> ) )
      result-&gt;VERBOSE = exp-&gt;bool_data( </font><font class="string">&quot;verbose&quot;</font><font class="text"> ) ;
   </font><font class="kw1">if</font><font class="text">( exp-&gt;has_entry( </font><font class="string">&quot;save_matrix_at_iteration&quot;</font><font class="text"> ) )
      result-&gt;SAVE_MATRIX_ITER_NB = exp-&gt;int_data( </font><font class="string">&quot;save_matrix_at_iteration&quot;</font><font class="text"> ) ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result != 0 ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result-&gt;owner() == a_owner ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result-&gt;stop_on_error() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result-&gt;zero_initial_guess() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( !result-&gt;matrix_is_set() ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_Solver</font><font class="text">:: </font><font class="kw3">LA_Solver</font><font class="text">( </font><font class="kw3">PEL_Object</font><font class="text">* a_owner )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">   : </font><font class="kw3">PEL_Object</font><font class="text">( a_owner )
   , IS_PROTO( </font><font class="kw1">false</font><font class="text"> )
   , SOLVER_NAME( </font><font class="string">&quot;&quot;</font><font class="text"> )
   , ITERATIVE( </font><font class="kw1">false</font><font class="text"> )
   , ZERO_INIT( </font><font class="kw1">true</font><font class="text"> )
   , STOP( </font><font class="kw1">true</font><font class="text"> )
   , VERBOSE( </font><font class="kw1">false</font><font class="text"> )
   , SIZE( </font><font class="kw3">PEL</font><font class="text">::bad_index() )
   , NB_ITER( </font><font class="kw3">PEL</font><font class="text">::bad_index() )
   , SOL_ACHIEVED( </font><font class="kw1">false</font><font class="text"> )
   , MATRIX( 0 )
   , SAVE_MATRIX_ITER_NB( -1 )
{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: LA_Solver&quot;</font><font class="text"> ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_Solver</font><font class="text">:: </font><font class="kw3">LA_Solver</font><font class="text">( </font><font class="kw3">PEL_Object</font><font class="text">* a_owner, </font><font class="kw3">LA_Solver</font><font class="text"> </font><font class="kw1">const</font><font class="text">* other )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">   : </font><font class="kw3">PEL_Object</font><font class="text">( a_owner )
   , IS_PROTO( </font><font class="kw1">false</font><font class="text"> )
   , SOLVER_NAME( </font><font class="string">&quot;copy of &quot;</font><font class="text">+other-&gt;SOLVER_NAME )
   , ITERATIVE( other-&gt;ITERATIVE )
   , ZERO_INIT( other-&gt;ZERO_INIT )
   , STOP( other-&gt;STOP )
   , VERBOSE( other-&gt;VERBOSE )
   , SIZE( </font><font class="kw3">PEL</font><font class="text">::bad_index() )
   , NB_ITER( </font><font class="kw3">PEL</font><font class="text">::bad_index() )
   , SOL_ACHIEVED( </font><font class="kw1">false</font><font class="text"> )
   , MATRIX( 0 )
   , SAVE_MATRIX_ITER_NB( other-&gt;SAVE_MATRIX_ITER_NB )
{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: LA_Solver&quot;</font><font class="text"> ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_Solver</font><font class="text">:: </font><font class="kw3">LA_Solver</font><font class="text">( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; a_name )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">   : </font><font class="kw3">PEL_Object</font><font class="text">( plugins_map() )
   , IS_PROTO( </font><font class="kw1">true</font><font class="text"> )
   , SOLVER_NAME( a_name )
   , ITERATIVE( </font><font class="kw1">false</font><font class="text"> )
   , ZERO_INIT( </font><font class="kw1">true</font><font class="text"> )
   , STOP( </font><font class="kw1">true</font><font class="text"> )
   , VERBOSE( </font><font class="kw1">false</font><font class="text"> )
   , SIZE( </font><font class="kw3">PEL</font><font class="text">::bad_index() )
   , NB_ITER( </font><font class="kw3">PEL</font><font class="text">::bad_index() )
   , SOL_ACHIEVED( </font><font class="kw1">false</font><font class="text"> )
   , MATRIX( 0 )
   , SAVE_MATRIX_ITER_NB( -1 )
{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: LA_Solver&quot;</font><font class="text"> ) ;
   plugins_map()-&gt;register_item( a_name, </font><font class="kw1">this</font><font class="text"> ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_Solver</font><font class="text">:: ~</font><font class="kw3">LA_Solver</font><font class="text">( </font><font class="kw1">void</font><font class="text"> )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: ~LA_Solver&quot;</font><font class="text"> ) ;
   </font><font class="comment">//PEL_CHECK( is_a_prototype() || ! matrix_is_set() ) ;
</font><font class="text">}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_Solver</font><font class="text">:: set_stop_on_error( </font><font class="kw1">bool</font><font class="text"> stop )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: set_stop_on_error&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( !is_a_prototype() ) ;

   STOP = stop ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( stop_on_error() == stop ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: stop_on_error( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">return</font><font class="text">( STOP ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: matrix_is_set( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">return</font><font class="text">( MATRIX!=0 ) ;
}


</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_Matrix</font><font class="text"> </font><font class="kw1">const</font><font class="text">*
</font><font class="kw3">LA_Solver</font><font class="text">:: matrix( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( matrix_is_set() ) ;
   </font><font class="kw1">return</font><font class="text">( MATRIX ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_Implementation</font><font class="text"> </font><font class="kw1">const</font><font class="text">*
</font><font class="kw3">LA_Solver</font><font class="text">:: matrix_implementation( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: matrix_implementation&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( matrix_is_set() ) ;
   </font><font class="kw1">return</font><font class="text">( MATRIX-&gt;implementation() ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: is_verbose( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">return</font><font class="text">( VERBOSE ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw2">size_t
</font><font class="kw3">LA_Solver</font><font class="text">:: size( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: size&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( matrix_is_set() ) ;

   </font><font class="kw1">return</font><font class="text">( SIZE ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: solution_is_achieved( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: solution_is_achieved&quot;</font><font class="text"> ) ;

   </font><font class="kw1">return</font><font class="text">( SOL_ACHIEVED ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw2">size_t
</font><font class="kw3">LA_Solver</font><font class="text">:: nb_iterations_achieved( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: nb_iterations_achieved&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( solution_is_achieved() ) ;

   </font><font class="kw2">size_t</font><font class="text"> result = NB_ITER ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( </font><font class="kw3">IMPLIES</font><font class="text">( !is_iterative(), result==1 ) ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: is_iterative( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: is_iterative&quot;</font><font class="text"> ) ;
   </font><font class="kw1">return</font><font class="text">( ITERATIVE ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_Solver</font><font class="text">:: set_iterative( </font><font class="kw1">bool</font><font class="text"> iterative )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: set_iterative&quot;</font><font class="text"> ) ;
   ITERATIVE = iterative ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( is_iterative() == iterative ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_Solver</font><font class="text">:: set_initial_guess_nonzero( </font><font class="kw1">bool</font><font class="text"> flg )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: set_initial_guess_nonzero&quot;</font><font class="text"> ) ;

   </font><font class="kw1">if</font><font class="text">( is_iterative() ) ZERO_INIT = !flg ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( </font><font class="kw3">IMPLIES</font><font class="text">( is_iterative(),
                            zero_initial_guess() == !flg ) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: zero_initial_guess( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">return</font><font class="text">( ZERO_INIT ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_Solver</font><font class="text">:: set_matrix( </font><font class="kw3">LA_Matrix</font><font class="text"> </font><font class="kw1">const</font><font class="text">* mat )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: set_matrix&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( mat != 0 ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( mat-&gt;nb_rows() &gt; 0 ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( mat-&gt;nb_rows() == mat-&gt;nb_cols() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( !matrix_is_set() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( mat-&gt;is_synchronized() ) ;

   </font><font class="kw1">if</font><font class="text">( is_verbose() )
   {
      </font><font class="kw3">PEL</font><font class="text">::out() &lt;&lt; SOLVER_NAME
                 &lt;&lt; </font><font class="string">&quot;: setting matrix of size &quot;
</font><font class="text">                 &lt;&lt; mat-&gt;nb_rows() &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
   }

   </font><font class="kw1">if</font><font class="text">( SAVE_MATRIX_ITER_NB==0 )
   {
      </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">ostringstream</font><font class="text"> os ;
      </font><font class="kw1">static</font><font class="text"> </font><font class="kw2">size_t</font><font class="text"> save_index = 0 ;

      os &lt;&lt; SOLVER_NAME &lt;&lt; save_index++ &lt;&lt; </font><font class="string">&quot;.mtx&quot;</font><font class="text"> ;
      </font><font class="kw3">PEL</font><font class="text">::out() &lt;&lt; </font><font class="string">&quot;Write matrix to file &quot;</font><font class="text"> &lt;&lt; os.str() &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
      mat-&gt;writeMM( os.str() ) ;
   }
   SAVE_MATRIX_ITER_NB-- ;

   SOL_ACHIEVED = </font><font class="kw1">false</font><font class="text"> ;
   </font><font class="kw1">bool</font><font class="text"> ok = </font><font class="kw1">false</font><font class="text"> ;
   set_matrix_self( mat, ok, </font><font class="kw1">false</font><font class="text"> ) ;
   </font><font class="kw1">if</font><font class="text">( ok )
   {
      MATRIX = mat ;
      SIZE = mat-&gt;nb_rows() ;
   }
   </font><font class="kw1">if</font><font class="text">( !ok &amp;&amp; stop_on_error() )
   {
      </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_plain(
         </font><font class="string">&quot;*** LA_Solver error\n&quot;
</font><font class="text">         </font><font class="string">&quot;    set_matrix fails&quot;</font><font class="text"> ) ;
   }

   </font><font class="kw1">if</font><font class="text">( is_verbose() )
   {
      </font><font class="kw3">PEL</font><font class="text">::out() &lt;&lt; SOLVER_NAME &lt;&lt; </font><font class="string">&quot;: usage memory after matrix setting (Mo) : &quot;
</font><font class="text">                 &lt;&lt; </font><font class="kw3">PEL_System</font><font class="text">::used_memory() /1024 / 1024 &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
   }
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( !solution_is_achieved() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( </font><font class="kw3">IMPLIES</font><font class="text">( stop_on_error(),
                            matrix_is_set() ) ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( </font><font class="kw3">IMPLIES</font><font class="text">( matrix_is_set(),
                            matrix_implementation() == mat-&gt;implementation() ) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_Solver</font><font class="text">:: reset_matrix( </font><font class="kw1">void</font><font class="text"> )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: reset_matrix&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( matrix_is_set() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( size()==matrix()-&gt;nb_rows() ) ; </font><font class="comment">// pas suffisant, mais c'est deja cela
</font><font class="text">
   </font><font class="kw1">if</font><font class="text">( is_verbose() )
   {
      </font><font class="kw3">PEL</font><font class="text">::out() &lt;&lt; SOLVER_NAME
                 &lt;&lt; </font><font class="string">&quot;: resetting matrix of size &quot;
</font><font class="text">                 &lt;&lt; MATRIX-&gt;nb_rows() &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
   }

   </font><font class="kw1">if</font><font class="text">( SAVE_MATRIX_ITER_NB==0 )
   {
      </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">ostringstream</font><font class="text"> os ;
      os &lt;&lt; SOLVER_NAME &lt;&lt; hash_code() &lt;&lt; </font><font class="string">&quot;.mtx&quot;</font><font class="text"> ;
      </font><font class="kw3">PEL</font><font class="text">::out() &lt;&lt; </font><font class="string">&quot;Write matrix to file &quot;</font><font class="text"> &lt;&lt; os.str() &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
      MATRIX-&gt;writeMM( os.str() ) ;
   }
   SAVE_MATRIX_ITER_NB-- ;

   SOL_ACHIEVED = </font><font class="kw1">false</font><font class="text"> ;
   </font><font class="kw1">bool</font><font class="text"> ok = </font><font class="kw1">false</font><font class="text"> ;
   set_matrix_self( MATRIX, ok, </font><font class="kw1">true</font><font class="text"> ) ;
   </font><font class="kw1">if</font><font class="text">( !ok &amp;&amp; stop_on_error() )
   {
      </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_plain(
         </font><font class="string">&quot;*** LA_Solver error\n&quot;
</font><font class="text">         </font><font class="string">&quot;    set_matrix fails&quot;</font><font class="text"> ) ;
   }

   </font><font class="kw1">if</font><font class="text">( is_verbose() )
   {
      </font><font class="kw3">PEL</font><font class="text">::out() &lt;&lt; SOLVER_NAME &lt;&lt; </font><font class="string">&quot;: usage memory after matrix setting (Mo) : &quot;
</font><font class="text">                 &lt;&lt; </font><font class="kw3">PEL_System</font><font class="text">::used_memory() /1024 / 1024 &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
   }
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( !solution_is_achieved() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( </font><font class="kw3">IMPLIES</font><font class="text">( stop_on_error(),
                            matrix_is_set() ) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_Solver</font><font class="text">:: unset_matrix( </font><font class="kw1">void</font><font class="text"> )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: unset_matrix&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( matrix_is_set() ) ;

   unset_matrix_self() ;
   MATRIX=0 ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( !matrix_is_set() ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_Solver</font><font class="text">:: solve( </font><font class="kw3">LA_Vector</font><font class="text"> </font><font class="kw1">const</font><font class="text">* b, </font><font class="kw3">LA_Vector</font><font class="text">* x )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: solve&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( matrix_is_set() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( b != 0 ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( b-&gt;nb_rows() == size() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( b-&gt;implementation() == matrix_implementation() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( b-&gt;is_synchronized() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">(
       b-&gt;row_distribution()-&gt;is_compatible( matrix()-&gt;row_distribution() ) ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( x != 0 ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( x-&gt;nb_rows() == size() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( x-&gt;implementation() == matrix_implementation() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">(
       x-&gt;row_distribution()-&gt;is_compatible( matrix()-&gt;row_distribution() ) ) ;

   </font><font class="kw1">if</font><font class="text">( is_verbose() )
      </font><font class="kw3">PEL</font><font class="text">::out() &lt;&lt; SOLVER_NAME &lt;&lt; </font><font class="string">&quot; : solving system&quot;</font><font class="text"> &lt;&lt;</font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;

   solve_self( b, x, NB_ITER, SOL_ACHIEVED ) ;
   x-&gt;synchronize() ;

   </font><font class="kw1">if</font><font class="text">( !SOL_ACHIEVED &amp;&amp; stop_on_error() )
   {
      </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_plain( </font><font class="string">&quot;LA_Solver:: solve fail&quot;</font><font class="text"> ) ;
   }
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( </font><font class="kw3">IMPLIES</font><font class="text">( stop_on_error(), solution_is_achieved() ) ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( x-&gt;is_synchronized() ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_Solver</font><font class="text">:: print( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">ostream</font><font class="text">&amp; os, </font><font class="kw2">size_t</font><font class="text"> indent_width ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_Solver:: print&quot;</font><font class="text"> ) ;
   </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text"> s( indent_width, </font><font class="string">' '</font><font class="text"> ) ;
   os &lt;&lt; s &lt;&lt; SOLVER_NAME ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: is_a_prototype( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">return</font><font class="text">( IS_PROTO ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_Solver</font><font class="text">:: raise_fatal_error_if_not_sequential( </font><font class="kw1">void</font><font class="text"> )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">if</font><font class="text">( </font><font class="kw3">PEL_Exec</font><font class="text">::communicator()-&gt;nb_ranks() &gt; 1 )
   {
      </font><font class="kw2">ostringstream</font><font class="text"> mesg ;
      mesg &lt;&lt; </font><font class="string">&quot;*** &quot;</font><font class="text"> &lt;&lt; type_name() &lt;&lt; </font><font class="string">&quot; error:&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
      mesg &lt;&lt; </font><font class="string">&quot;    parallel execution of multiple processes&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
      mesg &lt;&lt; </font><font class="string">&quot;    is not supported&quot;</font><font class="text"> ;
      </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_plain( mesg.str() ) ;
   }
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: create_clone_POST( </font><font class="kw3">LA_Solver</font><font class="text"> </font><font class="kw1">const</font><font class="text">* result,
                               </font><font class="kw3">PEL_Object</font><font class="text">* a_owner ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( </font><font class="kw3">PEL_Object</font><font class="text">::create_clone_POST( result, a_owner ) ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( !result-&gt;is_a_prototype() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( result-&gt;is_iterative() == is_iterative() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( result-&gt;stop_on_error() == stop_on_error() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( result-&gt;is_verbose() == is_verbose() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( result-&gt;zero_initial_guess() == zero_initial_guess() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( !result-&gt;matrix_is_set() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( !result-&gt;solution_is_achieved() ) ;
   </font><font class="kw1">return</font><font class="text">( </font><font class="kw1">true</font><font class="text"> ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: create_replica_PRE( </font><font class="kw3">PEL_Object</font><font class="text">* a_owner,
                                </font><font class="kw3">PEL_ModuleExplorer</font><font class="text"> </font><font class="kw1">const</font><font class="text">* exp ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( exp != 0 ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( is_a_prototype() ) ;
   </font><font class="kw1">return</font><font class="text">( </font><font class="kw1">true</font><font class="text"> ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: create_replica_POST( </font><font class="kw3">LA_Solver</font><font class="text"> </font><font class="kw1">const</font><font class="text">* result,
                                 </font><font class="kw3">PEL_Object</font><font class="text">* a_owner,
                                 </font><font class="kw3">PEL_ModuleExplorer</font><font class="text"> </font><font class="kw1">const</font><font class="text">* exp ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( result != 0 ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( !result-&gt;is_a_prototype() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( result-&gt;owner()==a_owner ) ;
   </font><font class="kw1">return</font><font class="text">( </font><font class="kw1">true</font><font class="text"> ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: unset_matrix_self_PRE( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( !is_a_prototype() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( matrix_is_set() ) ;
   </font><font class="kw1">return</font><font class="text">( </font><font class="kw1">true</font><font class="text"> ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: set_matrix_self_PRE(
                         </font><font class="kw3">LA_Matrix</font><font class="text"> </font><font class="kw1">const</font><font class="text">* mat, </font><font class="kw1">bool</font><font class="text"> same_pattern ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( !is_a_prototype() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( </font><font class="kw3">EQUIVALENT</font><font class="text">( same_pattern, matrix_is_set() ) ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( mat != 0 ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( mat-&gt;nb_rows() &gt; 0 ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( mat-&gt;nb_rows() == mat-&gt;nb_cols() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( mat-&gt;is_synchronized() ) ;
   </font><font class="kw1">return</font><font class="text">( </font><font class="kw1">true</font><font class="text"> ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: set_matrix_self_POST( </font><font class="kw3">LA_Matrix</font><font class="text"> </font><font class="kw1">const</font><font class="text">* mat, </font><font class="kw1">bool</font><font class="text"> ok ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">return</font><font class="text">( </font><font class="kw1">true</font><font class="text"> ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: solve_self_PRE( </font><font class="kw3">LA_Vector</font><font class="text"> </font><font class="kw1">const</font><font class="text">* b,
                            </font><font class="kw3">LA_Vector</font><font class="text"> </font><font class="kw1">const</font><font class="text">* x ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( !is_a_prototype() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( matrix_is_set() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( b != 0 ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( b-&gt;implementation() == matrix_implementation() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( b-&gt;nb_rows() == size() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( x != 0 ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( x-&gt;implementation() == matrix_implementation() ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( x-&gt;nb_rows() == size() ) ;
   </font><font class="kw1">return</font><font class="text">( </font><font class="kw1">true</font><font class="text"> ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_Solver</font><font class="text">:: solve_self_POST( </font><font class="kw3">LA_Vector</font><font class="text"> </font><font class="kw1">const</font><font class="text">* b,
                             </font><font class="kw3">LA_Vector</font><font class="text"> </font><font class="kw1">const</font><font class="text">* x,
                             </font><font class="kw2">size_t</font><font class="text"> nb_iter,
                             </font><font class="kw1">bool</font><font class="text"> ok ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">return</font><font class="text">( </font><font class="kw1">true</font><font class="text"> ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">PEL_ObjectRegister</font><font class="text">*
</font><font class="kw3">LA_Solver</font><font class="text">:: plugins_map( </font><font class="kw1">void</font><font class="text"> )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">static</font><font class="text"> </font><font class="kw3">PEL_ObjectRegister</font><font class="text">* result =
      </font><font class="kw3">PEL_ObjectRegister</font><font class="text">::create( </font><font class="kw3">PEL_Root</font><font class="text">::object(),
                                  </font><font class="string">&quot;LA_Solver descendant&quot;</font><font class="text"> ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}


</font>
</pre>
</body>
</html>
