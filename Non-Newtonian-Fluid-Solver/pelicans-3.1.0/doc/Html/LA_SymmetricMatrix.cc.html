<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<html>
<head>
  <title>LA_SymmetricMatrix.cc</title>
  <link rel ="stylesheet" type="text/css" href="stylesheet.css" title="Style">
</head>
<script>
  function asd()
  {
    parent.document.title="LA_SymmetricMatrix.cc_PELICANS 17_03_2010 ";
  }
</script> 

<body onload="asd();">

<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<div id=navbar>
  <a name="navbar_top_firstrow"><!-- --></a>
  <div id=navbarapp>PELICANS 17_03_2010</div>
  <div id=navbarmenu>
    <a href="LApack-tree.html"><span>Tree</span></a>
    <a href="LA_SymmetricMatrix.html"><span>Class</span></a>
    <a href="LA_SymmetricMatrix.hh.html"><span>Header</span></a>
    <span class=selected>Implementation</span>
    <div id=navbarsub>
      <a href="index.html" target="_top">FRAMES :</a>
      <a href="LApack-tree.html" target="_top">: NO FRAMES</a>
    </div>
  </div>
</div>
<!-- ========== END OF NAVBAR ========== -->

<pre>
<font class="comment">/*
 *  Copyright 1995-2010 by IRSN
 *
 *  This software is an application framework, with a set of integrated
 *  reusable components, whose purpose is to simplify the task of developing
 *  softwares of numerical mathematics and scientific computing.
 *
 *  This software is governed by the CeCILL-C license under French law and
 *  abiding by the rules of distribution of free software. You can use, modify
 *  and/or redistribute the software under the terms of the CeCILL-C license
 *  as circulated by CEA, CNRS and INRIA at the following URL
 *  &quot;http://www.cecill.info&quot;.
 *
 *  As a counterpart to the access to the source code and rights to copy,
 *  modify and redistribute granted by the license, users are provided only
 *  with a limited warranty and the software's author, the holder of the
 *  economic rights, and the successive licensors have only limited liability.
 *
 *  In this respect, the user's attention is drawn to the risks associated
 *  with loading, using, modifying and/or developing or reproducing the
 *  software by the user in light of its specific status of free software,
 *  that may mean that it is complicated to manipulate, and that also
 *  therefore means that it is reserved for developers and experienced
 *  professionals having in-depth computer knowledge. Users are therefore
 *  encouraged to load and test the software's suitability as regards their
 *  requirements in conditions enabling the security of their systems and/or
 *  data to be ensured and, more generally, to use and operate it in the same
 *  conditions as regards security.
 *
 *  The fact that you are presently reading this means that you have had
 *  knowledge of the CeCILL-C license and that you accept its terms.
 */
</font><font class="text">
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">.hh&gt;

</font><font class="kw2">#include</font><font class="text"> &lt;fstream&gt;

</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">LA_SeqVector</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">LA_DenseMatrix</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">LA_SymmetricMatrixIterator</font><font class="text">.hh&gt;

</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_assertions</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_Error</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_ModuleExplorer</font><font class="text">.hh&gt;

</font><font class="kw3">LA_SymmetricMatrix</font><font class="text"> </font><font class="kw1">const</font><font class="text">*
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: PROTOTYPE = </font><font class="kw1">new</font><font class="text"> </font><font class="kw3">LA_SymmetricMatrix</font><font class="text">() ;

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">*
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: create( </font><font class="kw3">PEL_Object</font><font class="text">* a_owner, </font><font class="kw2">size_t</font><font class="text"> dim )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: create&quot;</font><font class="text"> ) ;

   </font><font class="kw3">LA_SymmetricMatrix</font><font class="text">* result = </font><font class="kw1">new</font><font class="text"> </font><font class="kw3">LA_SymmetricMatrix</font><font class="text">( a_owner, dim ) ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result != 0 ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result-&gt;owner() == a_owner ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result-&gt;name() == </font><font class="string">&quot;LA_SymmetricMatrix&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result-&gt;is_resizable() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result-&gt;state() == </font><font class="kw3">LA</font><font class="text">::Sync ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result-&gt;nb_rows() == dim ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result-&gt;nb_cols() == dim ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result-&gt;nb_stored_items() == dim*dim ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result-&gt;is_symmetric() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( </font><font class="kw3">FORALL</font><font class="text">( ( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;result-&gt;nb_rows() ; ++i ),
                      </font><font class="kw3">FORALL</font><font class="text">( ( </font><font class="kw2">size_t</font><font class="text"> j=0 ; j&lt;result-&gt;nb_cols() ; ++j ),
                         result-&gt;item(i,j) == 0.0 ) ) ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">*
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: create_matrix( </font><font class="kw3">PEL_Object</font><font class="text">* a_owner ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: create_matrix&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( create_matrix_PRE( a_owner ) ) ;

   </font><font class="kw3">LA_SymmetricMatrix</font><font class="text">* result = </font><font class="kw1">new</font><font class="text"> </font><font class="kw3">LA_SymmetricMatrix</font><font class="text">( a_owner, SIZE  ) ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( create_matrix_POST( result, a_owner ) ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">*
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: create_replica( </font><font class="kw3">PEL_Object</font><font class="text">* a_owner,
                                     </font><font class="kw3">PEL_ModuleExplorer</font><font class="text"> </font><font class="kw1">const</font><font class="text">* exp ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: create_replica&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK</font><font class="text">( create_replica_PRE( a_owner, exp ) ) ;

   </font><font class="kw1">int</font><font class="text"> size = 0 ;
   </font><font class="kw1">if</font><font class="text">( exp-&gt;has_entry( </font><font class="string">&quot;size&quot;</font><font class="text"> ) )
   {
      size = exp-&gt;int_data( </font><font class="string">&quot;size&quot;</font><font class="text"> ) ;
      exp-&gt;test_data( </font><font class="string">&quot;size&quot;</font><font class="text">, </font><font class="string">&quot;size &gt; 0&quot;</font><font class="text"> ) ;
   }

   </font><font class="kw3">LA_SymmetricMatrix</font><font class="text">* result = </font><font class="kw3">LA_SymmetricMatrix</font><font class="text">::create( a_owner, size ) ;

   </font><font class="kw3">PEL_CHECK</font><font class="text">( create_replica_POST( result, a_owner, exp ) ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: </font><font class="kw3">LA_SymmetricMatrix</font><font class="text">( </font><font class="kw1">void</font><font class="text"> )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">   : </font><font class="kw3">LA_SeqMatrix</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix&quot;</font><font class="text"> )
   , SIZE( 0 )
   , DIAG( 0 )
{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: LA_SymmetricMatrix( prototype )&quot;</font><font class="text"> ) ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( is_a_prototype() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( name() == </font><font class="string">&quot;LA_SymmetricMatrix&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( is_symmetric() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( is_resizable() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( state() == </font><font class="kw3">LA</font><font class="text">::Sync ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( nb_rows() == 0 ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( nb_cols() == 0 ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( nb_stored_items() == 0 ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: </font><font class="kw3">LA_SymmetricMatrix</font><font class="text">( </font><font class="kw3">PEL_Object</font><font class="text">* a_owner, </font><font class="kw2">size_t</font><font class="text"> dim )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">   : </font><font class="kw3">LA_SeqMatrix</font><font class="text">( a_owner, </font><font class="string">&quot;LA_SymmetricMatrix&quot;</font><font class="text"> )
   , SIZE( dim )
   , DIAG( dim*(dim+1)/2 )
{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: LA_SymmetricMatrix&quot;</font><font class="text"> ) ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( !is_a_prototype() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( name() == </font><font class="string">&quot;LA_SymmetricMatrix&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( is_symmetric() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( is_resizable() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( state() == </font><font class="kw3">LA</font><font class="text">::Sync ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( nb_rows() == dim ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( nb_cols() == dim ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( nb_stored_items() == dim*dim ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: ~</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">( </font><font class="kw1">void</font><font class="text"> )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: re_initialize_with_global_sizes( </font><font class="kw2">size_t</font><font class="text"> a_nb_rows,
                                                      </font><font class="kw2">size_t</font><font class="text"> a_nb_cols )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: re_initialize_with_global_sizes&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( re_initialize_with_global_sizes_PRE( a_nb_rows,
                                                       a_nb_cols ) ) ;

   </font><font class="kw1">if</font><font class="text">( a_nb_rows != a_nb_cols )
   {
      </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_internal(
         </font><font class="string">&quot;*** LA_SymmetricMatrix error:\n&quot;
</font><font class="text">         </font><font class="string">&quot;    re_initialize expects equal number&quot;
</font><font class="text">         </font><font class="string">&quot; of rows and columns&quot;</font><font class="text"> ) ;
   }

   SIZE = a_nb_rows ;
   DIAG.re_initialize( SIZE*(SIZE+1)/2 ) ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( re_initialize_with_global_sizes_POST( a_nb_rows,
                                                         a_nb_cols ) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: is_desynchronizable( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: is_desynchronizable&quot;</font><font class="text"> ) ;

   </font><font class="kw1">bool</font><font class="text"> result = </font><font class="kw1">false</font><font class="text"> ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result == </font><font class="kw1">false</font><font class="text"> ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw2">size_t
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: nb_rows( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">return</font><font class="text">( SIZE ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw2">size_t
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: nb_cols( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">return</font><font class="text">( SIZE ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">double
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: item( </font><font class="kw2">size_t</font><font class="text"> i, </font><font class="kw2">size_t</font><font class="text"> j ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: item&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( item_PRE( i, j ) ) ;

   </font><font class="kw1">double</font><font class="text"> result = DIAG( index( i, j ) ) ;

   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw2">size_t
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: nb_stored_items( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">return</font><font class="text">( SIZE*SIZE ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw2">size_t
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: allocated_memory( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">return</font><font class="text">( DIAG.size()*</font><font class="kw1">sizeof</font><font class="text">(</font><font class="kw1">double</font><font class="text">) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: is_symmetric( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: is_symmetric&quot;</font><font class="text"> ) ;

   </font><font class="kw1">bool</font><font class="text"> result = </font><font class="kw1">true</font><font class="text"> ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( is_symmetric_POST( result ) ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">LA_MatrixIterator</font><font class="text">*
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: create_stored_item_iterator(
                                             </font><font class="kw3">PEL_Object</font><font class="text">* a_owner ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: create_stored_item_iterator&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( create_stored_item_iterator_PRE( a_owner ) ) ;

   </font><font class="kw3">LA_MatrixIterator</font><font class="text">* result =
                   </font><font class="kw3">LA_SymmetricMatrixIterator</font><font class="text">::create( a_owner, </font><font class="kw1">this</font><font class="text"> ) ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( create_stored_item_iterator_POST( a_owner, result ) ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: set_item( </font><font class="kw2">size_t</font><font class="text"> i, </font><font class="kw2">size_t</font><font class="text"> j, </font><font class="kw1">double</font><font class="text"> x )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: set_item&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_SAVEOLD</font><font class="text">( </font><font class="kw3">LA</font><font class="text">::SyncState, state, state() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( set_item_PRE( i, j ) ) ;
   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;

   DIAG( index( i, j ) ) = x ;

   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( set_item_POST( i, j, </font><font class="kw3">OLD</font><font class="text">( state ) ) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: add_to_item( </font><font class="kw2">size_t</font><font class="text"> i, </font><font class="kw2">size_t</font><font class="text"> j, </font><font class="kw1">double</font><font class="text"> x )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: add_to_item&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_SAVEOLD</font><font class="text">( </font><font class="kw3">LA</font><font class="text">::SyncState, state, state() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( add_to_item_PRE( i, j ) ) ;
   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;

   DIAG( index( i, j ) ) += x ;

   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( add_to_item_POST( i, j, </font><font class="kw3">OLD</font><font class="text">( state ) ) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: set_stored_items( </font><font class="kw1">double</font><font class="text"> val )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: set_stored_items&quot;</font><font class="text"> ) ;

   DIAG.</font><font class="kw2">set</font><font class="text">( val ) ;
   synchronize() ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( set_stored_items_POST( val ) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: </font><font class="kw2">set</font><font class="text">( </font><font class="kw3">LA_Matrix</font><font class="text"> </font><font class="kw1">const</font><font class="text">* A, </font><font class="kw1">bool</font><font class="text"> same_pattern )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: set&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( set_PRE( A, same_pattern ) ) ;

   </font><font class="kw3">LA_SymmetricMatrix</font><font class="text"> </font><font class="kw1">const</font><font class="text">* sA =
                         </font><font class="kw1">dynamic_cast</font><font class="text">&lt;</font><font class="kw3">LA_SymmetricMatrix</font><font class="text"> </font><font class="kw1">const</font><font class="text">* &gt;( A ) ;
   </font><font class="kw1">if</font><font class="text">( sA==0 )
   {
      </font><font class="kw3">LA_SeqMatrix</font><font class="text">::</font><font class="kw2">set</font><font class="text">( A, same_pattern ) ;
   }
   </font><font class="kw1">else
</font><font class="text">   {
      DIAG = sA-&gt;DIAG ;
   }
   synchronize() ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( set_POST( A ) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: scale( </font><font class="kw1">double</font><font class="text"> alpha )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: scale&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( scale_PRE( alpha ) ) ;

   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;DIAG.size() ; ++i )
   {
      DIAG(i) *= alpha ;
   }

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( scale_POST( alpha ) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: add_Mat(
                   </font><font class="kw3">LA_Matrix</font><font class="text"> </font><font class="kw1">const</font><font class="text">* A, </font><font class="kw1">double</font><font class="text"> alpha, </font><font class="kw1">bool</font><font class="text"> same_pattern )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: add_Mat&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_SAVEOLD</font><font class="text">( </font><font class="kw3">LA</font><font class="text">::SyncState, state, state() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( add_Mat_PRE( A, alpha, same_pattern ) ) ;

   </font><font class="kw3">LA_SymmetricMatrix</font><font class="text"> </font><font class="kw1">const</font><font class="text">* SA =
                           </font><font class="kw1">dynamic_cast</font><font class="text">&lt;</font><font class="kw3">LA_SymmetricMatrix</font><font class="text"> </font><font class="kw1">const</font><font class="text">*&gt;( A ) ;
   </font><font class="kw1">if</font><font class="text">( SA != 0 )
   {
      </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;DIAG.size() ; ++i )
      {
         DIAG(i) += SA-&gt;DIAG(i)*alpha ;
      }
   }
   </font><font class="kw1">else
</font><font class="text">   {
      </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_bad_types( </font><font class="kw1">this</font><font class="text">, </font><font class="string">&quot;add_Mat&quot;</font><font class="text">, A ) ;
   }

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( add_Mat_POST( </font><font class="kw3">OLD</font><font class="text">( state ) ) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: add_Mat_tMat( </font><font class="kw3">LA_SeqMatrix</font><font class="text"> </font><font class="kw1">const</font><font class="text">* A, </font><font class="kw1">double</font><font class="text"> alpha )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: add_Mat_tMat( same matrix )&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( A != 0 ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( A-&gt;nb_rows()==nb_rows() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( A-&gt;is_synchronized() ) ;

   </font><font class="kw2">size_t</font><font class="text"> n = A-&gt;nb_rows() ;
   </font><font class="kw2">size_t</font><font class="text"> p = A-&gt;nb_cols() ;
   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;n ; i++ )
   {
      </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> j=0 ; j&lt;=i ; j++ )
      {
         </font><font class="kw1">double</font><font class="text"> x = item(i,j) ;
         </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> k=0 ; k&lt;p ; k++ )
         {
            x += alpha*A-&gt;item( i, k )*A-&gt;item( j, k ) ;
         }
         set_item( i, j, x) ;
      }
   }
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: invert( </font><font class="kw1">double</font><font class="text">&amp; det )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: invert&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( nb_rows()&gt;0 ) ;
   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;

   </font><font class="kw2">size_t</font><font class="text"> n = nb_rows() ;
   </font><font class="kw3">LA_DenseMatrix</font><font class="text">* tempMat = </font><font class="kw3">LA_DenseMatrix</font><font class="text">::create( 0, n , n ) ;
   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;n ; i++ )
   {
      </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> j=0 ; j&lt;n ; j++ )
      {
         tempMat-&gt;set_item( i, j, item( i, j ) ) ;
      }
   }
   tempMat-&gt;synchronize() ;
   tempMat-&gt;invert( det ) ;
   </font><font class="kw1">if</font><font class="text">( det != 0.0 )
   {
      </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;n ; i++ )
      {
         </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> j=i ; j&lt;n ; j++ )
         {
            set_item( i, j, tempMat-&gt;item( i, j ) ) ;
         }
      }
   }
   </font><font class="kw1">else
</font><font class="text">   {

      re_initialize_with_global_sizes( 0, 0 ) ;
   }
   synchronize() ;
   tempMat-&gt;destroy() ;

   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( is_synchronized() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( </font><font class="kw3">IMPLIES</font><font class="text">( det==0, nb_rows()==0 &amp;&amp; nb_cols()==0 ) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: eigen_reduce( </font><font class="kw2">size_t</font><font class="text"> matord,
                                   </font><font class="kw3">LA_SeqVector</font><font class="text">* egval,
                                   </font><font class="kw3">LA_DenseMatrix</font><font class="text">* egvecs,
                                   </font><font class="kw1">bool</font><font class="text">&amp; success ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: eigen_reduce&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( matord &lt;= nb_rows() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( egval != 0 ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( egval-&gt;nb_rows() == matord ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( egvecs != 0 ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( egvecs-&gt;nb_rows() == matord ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( egvecs-&gt;nb_cols() == matord ) ;

   </font><font class="kw3">LA_SeqVector</font><font class="text">* w2 = </font><font class="kw3">LA_SeqVector</font><font class="text">::create( 0, matord ) ;
   reduce( matord, egval, w2, egvecs ) ;
   success = eigenV( matord, egval, w2, egvecs ) ;
   w2-&gt;destroy() ; w2 = 0 ;
   </font><font class="kw1">if</font><font class="text">( !success )
   {
      egval-&gt;</font><font class="kw2">set</font><font class="text">( </font><font class="kw3">PEL</font><font class="text">::bad_double() ) ;
      egvecs-&gt;set_stored_items( </font><font class="kw3">PEL</font><font class="text">::bad_double() ) ;
   }
   egval-&gt;synchronize() ;
   egvecs-&gt;synchronize() ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( egval-&gt;is_synchronized() ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( egvecs-&gt;is_synchronized() ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: reduce( </font><font class="kw2">size_t</font><font class="text"> matord,
                             </font><font class="kw3">LA_SeqVector</font><font class="text">* diagTDMA,
                             </font><font class="kw3">LA_SeqVector</font><font class="text">* subdTDMA,
                             </font><font class="kw3">LA_DenseMatrix</font><font class="text">* orth ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: reduce&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( matord &lt;= nb_rows() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( diagTDMA != 0 ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( diagTDMA-&gt;nb_rows() == matord ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( subdTDMA != 0 ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( subdTDMA-&gt;nb_rows() == matord ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( orth != 0 ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( orth-&gt;nb_rows() == matord ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( orth-&gt;nb_cols() == matord ) ;

   </font><font class="kw2">size_t</font><font class="text"> i ;
   </font><font class="kw1">for</font><font class="text">( i=0 ; i &lt; matord ; i++ )
   {
      </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> j=0 ; j &lt; matord ; j++ )
      {
         orth-&gt;set_item( i, j, item( i, j ) ) ;
      }
   }
   </font><font class="kw1">for</font><font class="text">( i=matord-1 ; i &gt;= 1 ; i-- )
   {
      </font><font class="kw2">size_t</font><font class="text"> l = i-1 ;
      </font><font class="kw1">double</font><font class="text"> h = 0. ;
      </font><font class="kw1">double</font><font class="text"> scal = 0. ;
      </font><font class="kw1">if</font><font class="text">( l &gt; 0 )
      {
         </font><font class="kw2">size_t</font><font class="text"> k ;
         </font><font class="kw1">for</font><font class="text">(  k = 0 ; k &lt;= l ; k++ )
         {
            scal += </font><font class="kw3">PEL</font><font class="text">::abs( orth-&gt;item( i, k ) ) ;
         }
         </font><font class="kw1">if</font><font class="text">( scal == 0.0 )
         </font><font class="comment">// skip transformation
</font><font class="text">         {
            subdTDMA-&gt;set_item( i, orth-&gt;item( i, l ) ) ;
         }
         </font><font class="kw1">else
</font><font class="text">         {
            </font><font class="kw1">for</font><font class="text">( k= 0 ; k &lt;= l ; k++ )
            {
               orth-&gt;set_item( i, k, orth-&gt;item( i, k ) / scal ) ;
               h += orth-&gt;item( i, k )*orth-&gt;item( i, k ) ;
            }
            </font><font class="kw1">double</font><font class="text"> f = orth-&gt;item( i, l ) ;
            </font><font class="kw1">double</font><font class="text"> g = ( f &gt;= 0 ? -</font><font class="kw3">PEL</font><font class="text">::sqrt( h ) : </font><font class="kw3">PEL</font><font class="text">::sqrt( h ) ) ;
            subdTDMA-&gt;set_item( i, scal*g ) ;
            h -= f*g ;
            orth-&gt;set_item( i, l, f-g ) ;
            f = 0. ;
            </font><font class="kw2">size_t</font><font class="text"> j ;
            </font><font class="kw1">for</font><font class="text">(  j = 0 ; j &lt;= l ; j++ )
            {
               orth-&gt;set_item( j, i, orth-&gt;item( i, j )/h ) ;
               g = 0. ;
               </font><font class="kw1">for</font><font class="text">( k=0 ; k &lt;= j ; k++ )
               {
                  g += orth-&gt;item( j, k )*orth-&gt;item( i, k ) ;
               }
               </font><font class="kw1">for</font><font class="text">( k=j+1 ; k &lt;= l ; k++ )
               {
                  g += orth-&gt;item( k, j )*orth-&gt;item( i, k ) ;
               }
               subdTDMA-&gt;set_item( j, g/h ) ;
               f += subdTDMA-&gt;item( j )*orth-&gt;item( i, j ) ;
            }
            </font><font class="kw1">double</font><font class="text"> hh = f/( h+h ) ;
            </font><font class="kw1">for</font><font class="text">( j=0 ; j &lt;= l ; j++ )
            {
               f = orth-&gt;item( i, j ) ;
               g = subdTDMA-&gt;item( j ) - hh*f ;
               subdTDMA-&gt;set_item( j, g ) ;
               </font><font class="kw1">for</font><font class="text">( k = 0 ; k &lt;= j ; k++ )
               {
                  orth-&gt;set_item( j, k, orth-&gt;item( j, k )-
                                     ( f*subdTDMA-&gt;item( k ) +
                                       g*orth-&gt;item( i, k ) ) ) ;
               }
            }
         }
      }
      </font><font class="kw1">else
</font><font class="text">      {
         subdTDMA-&gt;set_item( i, orth-&gt;item( i, l ) ) ;
      }
      diagTDMA-&gt;set_item( i, h ) ;
   }


   </font><font class="comment">//  Accumulation of transformation matrices
</font><font class="text">   subdTDMA-&gt;set_item( 0, 0. ) ;
   diagTDMA-&gt;set_item( 0, 0. ) ;
   </font><font class="kw1">for</font><font class="text">( i=0 ; i &lt; matord ; i++ )
   {
      </font><font class="kw1">int</font><font class="text"> l = i-1 ;
      </font><font class="kw1">if</font><font class="text">( diagTDMA-&gt;item( i ) != 0. )
      {
         </font><font class="kw1">for</font><font class="text">( </font><font class="kw1">int</font><font class="text"> j=0 ; j &lt;= l ; j++ )
         {
            </font><font class="kw1">double</font><font class="text"> g = 0. ;
            </font><font class="kw1">int</font><font class="text"> k ;
            </font><font class="kw1">for</font><font class="text">( k=0 ; k&lt;= l ; k++ )
               g += orth-&gt;item( i, k )*orth-&gt;item( k, j ) ;
            </font><font class="kw1">for</font><font class="text">( k = 0 ; k &lt;= l ; k++ )
               orth-&gt;set_item( k, j, orth-&gt;item( k, j ) -
                                     g*orth-&gt;item( k, i ) ) ;
         }
      }
      diagTDMA-&gt;set_item( i, orth-&gt;item( i, i ) ) ;
      orth-&gt;set_item( i, i, 1.0 ) ;
      </font><font class="kw1">for</font><font class="text">( </font><font class="kw1">int</font><font class="text"> j=0 ; j &lt;= l ; j++ )
      {
         orth-&gt;set_item( i, j, 0. ) ;
         orth-&gt;set_item( j, i, 0. ) ;
      }
   }
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: eigenV( </font><font class="kw2">size_t</font><font class="text"> matord,
                             </font><font class="kw3">LA_SeqVector</font><font class="text">* diagTDMA,
                             </font><font class="kw3">LA_SeqVector</font><font class="text">* subdTDMA,
                             </font><font class="kw3">LA_DenseMatrix</font><font class="text">* eigv ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: eigenV&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( matord &lt;= nb_rows() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( diagTDMA != 0 ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( diagTDMA-&gt;nb_rows() == matord ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( subdTDMA != 0 ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( subdTDMA-&gt;nb_rows() == matord ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( eigv != 0 ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( eigv-&gt;nb_rows() == matord ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( eigv-&gt;nb_cols() == matord ) ;

   </font><font class="kw1">if</font><font class="text">( matord == 1 )
   {
      </font><font class="kw1">return</font><font class="text">( </font><font class="kw1">true</font><font class="text"> ) ;
   }

   </font><font class="kw2">size_t</font><font class="text"> i ;
   </font><font class="kw1">for</font><font class="text">( i=1 ; i &lt; matord ; i++ )
   {
      subdTDMA-&gt;set_item( i-1, subdTDMA-&gt;item( i ) ) ;
   }

   subdTDMA-&gt;set_item( matord-1, 0.0 ) ;
   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> l=0 ; l &lt; matord ; l++ )
   {
      </font><font class="kw2">size_t</font><font class="text"> iter = 0 ;
      </font><font class="kw2">size_t</font><font class="text"> m ;

      </font><font class="kw1">do
</font><font class="text">      {
         </font><font class="kw1">for</font><font class="text">( m=l ; m &lt; matord-1 ; m++ )
         {
            </font><font class="kw1">double</font><font class="text"> dd = </font><font class="kw3">PEL</font><font class="text">::abs( diagTDMA-&gt;item( m ) )
                       +</font><font class="kw3">PEL</font><font class="text">::abs( diagTDMA-&gt;item( m+1 ) ) ;
            </font><font class="kw1">if</font><font class="text">( dd!=0.0 &amp;&amp;
                </font><font class="kw3">PEL</font><font class="text">::abs( subdTDMA-&gt;item( m )/dd )&lt; 1.E-14 )
            {
               </font><font class="kw1">break</font><font class="text"> ;
            }
         }
         </font><font class="kw1">if</font><font class="text">( m != l )
         {
            </font><font class="kw1">if</font><font class="text">( iter++ == 30 )
            {
               </font><font class="kw1">return</font><font class="text">( </font><font class="kw1">false</font><font class="text"> ) ;
            }
            </font><font class="comment">// form shift
</font><font class="text">            </font><font class="kw1">double</font><font class="text"> g= ( diagTDMA-&gt;item( l+1 )-diagTDMA-&gt;item( l ) )
                     /( 2.0*subdTDMA-&gt;item( l ) ) ;
            </font><font class="kw1">double</font><font class="text"> r = </font><font class="kw3">PEL</font><font class="text">::sqrt( g*g+1.0 ) ;
            </font><font class="kw1">double</font><font class="text"> signr = ( g &gt;= 0.0 ? r : -r ) ;

            g = diagTDMA-&gt;item( m ) - diagTDMA-&gt;item( l )
               +subdTDMA-&gt;item( l )/( g+signr ) ;

            </font><font class="kw1">double</font><font class="text"> s = 1.0 ;
            </font><font class="kw1">double</font><font class="text"> c = 1.0 ;
            </font><font class="kw1">double</font><font class="text"> p = 0. ;

            </font><font class="kw1">for</font><font class="text">( i = m-1 ; i &gt;= l &amp;&amp; i&lt;=m-1 ; i-- )
            {
               </font><font class="kw1">double</font><font class="text"> f = s*subdTDMA-&gt;item( i ) ;
               </font><font class="kw1">double</font><font class="text"> b = c*subdTDMA-&gt;item( i ) ;
               </font><font class="kw1">if</font><font class="text">( </font><font class="kw3">PEL</font><font class="text">::abs( f ) &gt;= </font><font class="kw3">PEL</font><font class="text">::abs( g ) )
               {
                  c = g/f ;
                  r = </font><font class="kw3">PEL</font><font class="text">::sqrt( c*c+1.0 ) ;
                  subdTDMA-&gt;set_item( i+1, f*r ) ;
                  s = 1.0/r ;
                  c *= s ;
               }
               </font><font class="kw1">else
</font><font class="text">               {
                  s = f/g ;
                  r = </font><font class="kw3">PEL</font><font class="text">::sqrt( ( s*s ) + 1.0 ) ;
                  subdTDMA-&gt;set_item( i+1, g*r ) ;
                  c = 1.0/r ;
                  s *= c ;
               }
               g = diagTDMA-&gt;item( i+1 ) - p ;
               r = ( diagTDMA-&gt;item( i )-g )*s + 2.0*c*b ;
               p = s*r ;
               diagTDMA-&gt;set_item( i+1, g + p ) ;
               g = c*r - b ;

               </font><font class="comment">// Form eigenvectors
</font><font class="text">               </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> k=0 ; k &lt; matord ; k++ )
               {
                  f = eigv-&gt;item( k, i+1 ) ;
                  eigv-&gt;set_item( k, i+1,
                                      s*eigv-&gt;item( k, i ) + c*f ) ;
                  eigv-&gt;set_item( k, i,
                                      c*eigv-&gt;item( k, i ) - s*f ) ;
               }
            }

            diagTDMA-&gt;set_item( l, diagTDMA-&gt;item( l ) - p ) ;
            subdTDMA-&gt;set_item( l, g ) ;
            subdTDMA-&gt;set_item( m, 0 ) ;
         }

      } </font><font class="kw1">while</font><font class="text">( m != l ) ;
   }

   </font><font class="comment">//  Order eigenvectors and eigenvalues
</font><font class="text">   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> ii=1 ; ii &lt; matord ; ii++ )
   {
      i = ii-1 ;
      </font><font class="kw2">size_t</font><font class="text"> k = i ;
      </font><font class="kw1">double</font><font class="text"> p = diagTDMA-&gt;item( i ) ;
      </font><font class="kw2">size_t</font><font class="text"> j ;
      </font><font class="kw1">for</font><font class="text">( j = ii ; j &lt; matord ; j++ )
      {
         </font><font class="kw1">if</font><font class="text">( </font><font class="kw3">PEL</font><font class="text">::abs( diagTDMA-&gt;item( j ) ) &lt; p )
         {
            k = j ;
            p = diagTDMA-&gt;item( j ) ;
         }
      }
      </font><font class="kw1">if</font><font class="text">( k &gt; i )
      {
         diagTDMA-&gt;set_item( k, diagTDMA-&gt;item( i ) ) ;
         diagTDMA-&gt;set_item( i, p ) ;
         </font><font class="kw1">for</font><font class="text">( j = 0 ; j &lt; matord ; j++ )
         {
            p = eigv-&gt;item( j, i ) ;
            eigv-&gt;set_item( j, i, eigv-&gt;item( j, k ) ) ;
            eigv-&gt;set_item( j, k, p ) ;
         }
      }
   }
   </font><font class="kw1">return</font><font class="text">( </font><font class="kw1">true</font><font class="text"> ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: writeMM( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; file ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: writeMM&quot;</font><font class="text"> ) ;
   </font><font class="kw2">std</font><font class="text">::ofstream out( file.c_str() ) ;
   </font><font class="kw1">if</font><font class="text">( !out )
   {
      </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_file_handling( file, </font><font class="string">&quot;open&quot;</font><font class="text"> ) ;
   }
   out &lt;&lt; </font><font class="string">&quot;%%MatrixMarket matrix array real symmetric&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
   out &lt;&lt; nb_rows() &lt;&lt; </font><font class="string">&quot; &quot;</font><font class="text"> &lt;&lt; nb_cols() &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
   out.precision( 16 ) ;
   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> j=0; j&lt;nb_cols() ; j++ )
   {
      </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=j ; i&lt;nb_rows() ; i++ )
      {
         out &lt;&lt; item( i, j ) &lt;&lt; </font><font class="string">&quot; &quot;</font><font class="text"> ;
      }
      out &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
   }
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw2">size_t
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: index( </font><font class="kw2">size_t</font><font class="text"> i, </font><font class="kw2">size_t</font><font class="text"> j ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;LA_SymmetricMatrix:: index&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( i&lt;nb_rows() ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( j&lt;nb_rows() ) ;

   </font><font class="kw2">size_t</font><font class="text"> ii ;
   </font><font class="kw2">size_t</font><font class="text"> kk ;
   </font><font class="kw1">if</font><font class="text">( i&gt;j )
   {
      kk = i-j ;
      ii = j ;
   }
   </font><font class="kw1">else
</font><font class="text">   {
      kk = j-i ;
      ii = i ;
   }

   </font><font class="kw2">size_t</font><font class="text"> result = ii+SIZE*kk-kk*(kk-1)/2 ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result&lt;DIAG.size() ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: invariant( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( </font><font class="kw3">LA_SeqMatrix</font><font class="text">::invariant() ) ;
   </font><font class="kw1">return</font><font class="text">( </font><font class="kw1">true</font><font class="text"> ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">bool
</font><font class="kw3">LA_SymmetricMatrix</font><font class="text">:: is_symmetric_POST( </font><font class="kw1">bool</font><font class="text"> result ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( </font><font class="kw3">LA_Matrix</font><font class="text">::is_symmetric_POST( result ) ) ;
   </font><font class="kw3">PEL_ASSERT</font><font class="text">( result ) ;
   </font><font class="kw1">return</font><font class="text">( </font><font class="kw1">true</font><font class="text"> ) ;
}





</font>
</pre>
</body>
</html>
