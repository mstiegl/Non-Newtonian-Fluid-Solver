<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<html>
<head>
  <title>FE_ComparatorWithAnalytic.cc</title>
  <link rel ="stylesheet" type="text/css" href="stylesheet.css" title="Style">
</head>
<script>
  function asd()
  {
    parent.document.title="FE_ComparatorWithAnalytic.cc_PELICANS 17_03_2010 ";
  }
</script> 

<body onload="asd();">

<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<div id=navbar>
  <a name="navbar_top_firstrow"><!-- --></a>
  <div id=navbarapp>PELICANS 17_03_2010</div>
  <div id=navbarmenu>
    <a href="FEpack-tree.html"><span>Tree</span></a>
    <a href="FE_ComparatorWithAnalytic.html"><span>Class</span></a>
    <a href="FE_ComparatorWithAnalytic.hh.html"><span>Header</span></a>
    <span class=selected>Implementation</span>
    <div id=navbarsub>
      <a href="index.html" target="_top">FRAMES :</a>
      <a href="FEpack-tree.html" target="_top">: NO FRAMES</a>
    </div>
  </div>
</div>
<!-- ========== END OF NAVBAR ========== -->

<pre>
<font class="comment">/*
 *  Copyright 1995-2010 by IRSN
 *
 *  This software is an application framework, with a set of integrated  
 *  reusable components, whose purpose is to simplify the task of developing 
 *  softwares of numerical mathematics and scientific computing.
 * 
 *  This software is governed by the CeCILL-C license under French law and 
 *  abiding by the rules of distribution of free software. You can use, modify 
 *  and/or redistribute the software under the terms of the CeCILL-C license  
 *  as circulated by CEA, CNRS and INRIA at the following URL 
 *  &quot;http://www.cecill.info&quot;. 
 *
 *  As a counterpart to the access to the source code and rights to copy,  
 *  modify and redistribute granted by the license, users are provided only 
 *  with a limited warranty and the software's author, the holder of the  
 *  economic rights, and the successive licensors have only limited liability. 
 *
 *  In this respect, the user's attention is drawn to the risks associated  
 *  with loading, using, modifying and/or developing or reproducing the  
 *  software by the user in light of its specific status of free software,
 *  that may mean that it is complicated to manipulate, and that also  
 *  therefore means that it is reserved for developers and experienced 
 *  professionals having in-depth computer knowledge. Users are therefore 
 *  encouraged to load and test the software's suitability as regards their 
 *  requirements in conditions enabling the security of their systems and/or 
 *  data to be ensured and, more generally, to use and operate it in the same 
 *  conditions as regards security. 
 *
 *  The fact that you are presently reading this means that you have had 
 *  knowledge of the CeCILL-C license and that you accept its terms.
 */
</font><font class="text">
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">.hh&gt;

</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">FE</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">FE_TimeIterator</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">doubleVector</font><font class="text">.hh&gt;

</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">GE_Point</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">GE_Mpolyhedron</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">GE_QRprovider</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">GE_ReferencePolyhedron</font><font class="text">.hh&gt;

</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_assertions</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_Communicator</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_ContextSimple</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_DataWithContext</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_Double</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_DoubleVector</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_Error</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_Exec</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_ModuleExplorer</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_Root</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PEL_Variable</font><font class="text">.hh&gt;

</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PDE_CursorFEside</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PDE_DiscreteField</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PDE_DomainAndFields</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PDE_LocalFEbound</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PDE_LocalFEcell</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PDE_ResultSaver</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PDE_SetOfBCs</font><font class="text">.hh&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw3">PDE_SetOfDiscreteFields</font><font class="text">.hh&gt;

</font><font class="kw2">#include</font><font class="text"> &lt;iomanip&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;iostream&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;fstream&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;sstream&gt;
</font><font class="kw2">#include</font><font class="text"> &lt;</font><font class="kw2">string</font><font class="text">&gt;

</font><font class="kw1">using</font><font class="text"> </font><font class="kw2">std</font><font class="text">::istringstream ;
</font><font class="kw1">using</font><font class="text"> </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> ;
</font><font class="kw1">using</font><font class="text"> </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
</font><font class="kw1">using</font><font class="text"> </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">ios_base</font><font class="text"> ;
</font><font class="kw1">using</font><font class="text"> </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">setprecision</font><font class="text"> ; </font><font class="kw1">using</font><font class="text"> </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">setw</font><font class="text"> ;

</font><font class="kw1">struct</font><font class="text"> FE_ComparatorWithAnalytic_ERROR
{
   </font><font class="kw1">static</font><font class="text"> </font><font class="kw1">void</font><font class="text"> n0( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; field_name,
                   </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; error ) ;
   </font><font class="kw1">static</font><font class="text"> </font><font class="kw1">void</font><font class="text"> n1( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; save_name ) ;
   </font><font class="kw1">static</font><font class="text"> </font><font class="kw1">void</font><font class="text"> n2( </font><font class="kw3">GE_Mpolyhedron</font><font class="text"> </font><font class="kw1">const</font><font class="text">* poly ) ;
   </font><font class="kw1">static</font><font class="text"> </font><font class="kw1">void</font><font class="text"> n3( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; fname ) ;
   </font><font class="kw1">static</font><font class="text"> </font><font class="kw1">void</font><font class="text"> n4( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; norm_name, </font><font class="kw1">double</font><font class="text"> pp ) ;
} ;

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text"> </font><font class="kw1">const</font><font class="text">*
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: PROTOTYPE = </font><font class="kw1">new</font><font class="text"> </font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">() ;
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: </font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">( </font><font class="kw1">void</font><font class="text"> )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">   : </font><font class="kw3">FE_OneStepIteration</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic&quot;</font><font class="text"> )
   , FIELD( 0 )
   , LEVEL( </font><font class="kw3">PEL</font><font class="text">::bad_index() )
   , cFE( 0 )
   , sFE( 0 )
   , bFE( 0 )
   , QRP( 0 )
   , NORMS( </font><font class="kw3">intVector</font><font class="text">( 0 ) )
   , EXPOS( </font><font class="kw3">doubleVector</font><font class="text">( 0 ) )
   , IDX_EXPOS( </font><font class="kw3">doubleVector</font><font class="text">( 0 ) )
   , NORM_NAMES( </font><font class="kw3">stringVector</font><font class="text">( 0 ) )
   , NORM_SAVE_NAMES( </font><font class="kw3">stringVector</font><font class="text">( 0 ) )
   , COORDS( 0 )
   , TT( 0 )
   , SOL( 0 )
   , DSOL( 0 )
   , NULLIFY_INTEGRAL( </font><font class="kw1">false</font><font class="text"> )
   , DIST_REF( </font><font class="kw3">PEL</font><font class="text">::bad_double() )
   , COM( 0 )
   , SAVING_NUMBER( </font><font class="kw3">PEL</font><font class="text">::bad_index() )
   , NEXT_SAVING_TIME( </font><font class="kw3">PEL</font><font class="text">::bad_double() )
   , SAVING_TIMES( </font><font class="kw3">doubleVector</font><font class="text">( 0 ) )
{
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: ~</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">( </font><font class="kw1">void</font><font class="text"> )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">*
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: create_replica( </font><font class="kw3">PEL_Object</font><font class="text">* a_owner,
                                         </font><font class="kw3">PDE_DomainAndFields</font><font class="text"> </font><font class="kw1">const</font><font class="text">* dom,
                                         </font><font class="kw3">FE_SetOfParameters</font><font class="text"> </font><font class="kw1">const</font><font class="text">* prms,
                                         </font><font class="kw3">PEL_ModuleExplorer</font><font class="text">* exp ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: create_replica&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK</font><font class="text">( create_replica_PRE( a_owner, dom, prms, exp ) ) ;

   </font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">* result =
      </font><font class="kw1">new</font><font class="text"> </font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">( a_owner, dom, prms, exp ) ;

   </font><font class="kw3">PEL_CHECK</font><font class="text">( create_replica_POST( result, a_owner, dom, prms, exp ) ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: </font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">(
                                         </font><font class="kw3">PEL_Object</font><font class="text">* a_owner,
                                         </font><font class="kw3">PDE_DomainAndFields</font><font class="text"> </font><font class="kw1">const</font><font class="text">* dom,
                                         </font><font class="kw3">FE_SetOfParameters</font><font class="text"> </font><font class="kw1">const</font><font class="text">* prms,
                                         </font><font class="kw3">PEL_ModuleExplorer</font><font class="text">* exp )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">   : </font><font class="kw3">FE_OneStepIteration</font><font class="text">( a_owner, dom, exp )
   , FIELD( dom-&gt;set_of_discrete_fields()-&gt;item(
                                         exp-&gt;string_data( </font><font class="string">&quot;field&quot;</font><font class="text"> ) ) )
   , LEVEL( (</font><font class="kw2">size_t</font><font class="text">) exp-&gt;int_data( </font><font class="string">&quot;level&quot;</font><font class="text"> ) )
   , cFE( dom-&gt;create_LocalFEcell( </font><font class="kw1">this</font><font class="text"> ) )
   , sFE( dom-&gt;create_CursorFEside( </font><font class="kw1">this</font><font class="text"> ) )
   , bFE( dom-&gt;create_LocalFEbound( </font><font class="kw1">this</font><font class="text"> ) )
   , QRP( </font><font class="kw3">GE_QRprovider</font><font class="text">::object(
           exp-&gt;string_data( </font><font class="string">&quot;quadrature_rule_provider&quot;</font><font class="text"> ) ) )
   , BCs( dom-&gt;set_of_boundary_conditions() )
   , NORMS( </font><font class="kw3">intVector</font><font class="text">( 0 ) )
   , EXPOS( </font><font class="kw3">doubleVector</font><font class="text">( 0 ) )
   , IDX_EXPOS( </font><font class="kw3">doubleVector</font><font class="text">( 0 ) )
   , NORM_NAMES( exp-&gt;stringVector_data( </font><font class="string">&quot;norms&quot;</font><font class="text"> ) )
   , NORM_SAVE_NAMES( exp-&gt;stringVector_data( </font><font class="string">&quot;norm_saving_names&quot;</font><font class="text"> ) )
   , COORDS( 0 )
   , TT( 0 )
   , SOL( 0 )
   , DSOL( 0 )
   , NULLIFY_INTEGRAL(
            exp-&gt;has_entry( </font><font class="string">&quot;nullify_integral&quot;</font><font class="text"> ) ?
               exp-&gt;bool_data( </font><font class="string">&quot;nullify_integral&quot;</font><font class="text"> ) : </font><font class="kw1">false</font><font class="text"> )
   , DIST_REF(
      exp-&gt;has_entry( </font><font class="string">&quot;reference_distance&quot;</font><font class="text"> ) ?
      exp-&gt;double_data( </font><font class="string">&quot;reference_distance&quot;</font><font class="text"> ) : 0.01 )
   , COM( </font><font class="kw3">PEL_Exec</font><font class="text">::communicator() )
   , FILE_OUT( exp-&gt;has_entry( </font><font class="string">&quot;output_file&quot;</font><font class="text"> ) ? 
               exp-&gt;string_data( </font><font class="string">&quot;output_file&quot;</font><font class="text"> ) : </font><font class="string">&quot;&quot;</font><font class="text"> )
   , SAVING_NUMBER( </font><font class="kw3">PEL</font><font class="text">::bad_index() )
   , NEXT_SAVING_TIME( </font><font class="kw3">PEL</font><font class="text">::bad_double() )
   , SAVING_TIMES( exp-&gt;has_entry( </font><font class="string">&quot;saving_times&quot;</font><font class="text"> ) ? 
                      exp-&gt;doubleVector_data( </font><font class="string">&quot;saving_times&quot;</font><font class="text"> ) : 
                   </font><font class="kw3">doubleVector</font><font class="text">( 0 ) )
{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: FE_ComparatorWithAnalytic&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;

   check_field_storage_depth( FIELD, LEVEL ) ;

   </font><font class="comment">// Preprocessing :
</font><font class="text">   </font><font class="kw1">if</font><font class="text">( NULLIFY_INTEGRAL &amp;&amp; FIELD-&gt;nb_components() != 1 )
   {
      </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text"> msg =
         </font><font class="string">&quot;    nullify integral for 1 component\n&quot;
</font><font class="text">         </font><font class="string">&quot;    field only.&quot;</font><font class="text"> ;
      FE_ComparatorWithAnalytic_ERROR::n0( FIELD-&gt;name(), msg ) ;
   }

   </font><font class="comment">// Context :
</font><font class="text">   </font><font class="kw3">PEL_ContextSimple</font><font class="text">* ct = </font><font class="kw3">PEL_ContextSimple</font><font class="text">::create( </font><font class="kw1">this</font><font class="text"> ) ;
   COORDS = </font><font class="kw3">PEL_DoubleVector</font><font class="text">::create(
      ct, </font><font class="kw3">doubleVector</font><font class="text">( dom-&gt;nb_space_dimensions() ) ) ;
   ct-&gt;extend( </font><font class="kw3">PEL_Variable</font><font class="text">::object( </font><font class="string">&quot;DV_X&quot;</font><font class="text"> ), COORDS ) ;
   TT = </font><font class="kw3">PEL_Double</font><font class="text">::create( ct, 0.0 ) ;
   ct-&gt;extend( </font><font class="kw3">PEL_Variable</font><font class="text">::object( </font><font class="string">&quot;DS_T&quot;</font><font class="text"> ), TT ) ;
   
   </font><font class="comment">// Norms :
</font><font class="text">   </font><font class="kw1">if</font><font class="text">( NORM_NAMES.size()!=NORM_SAVE_NAMES.size() )
   {
      </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text"> msg =
         </font><font class="string">&quot;    \&quot;</font><font class="text">norms\</font><font class="string">&quot; and \&quot;</font><font class="text">norm_saving_names\</font><font class="string">&quot;\n&quot;
</font><font class="text">         </font><font class="string">&quot;    need to have the same dimension.&quot;</font><font class="text"> ;
      FE_ComparatorWithAnalytic_ERROR::n0( FIELD-&gt;name(), msg ) ;
   }
   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;NORM_NAMES.size() ; ++i )
   {
      </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> j=i+1 ; j&lt;NORM_NAMES.size() ; ++j )
      {
         </font><font class="kw1">if</font><font class="text">( NORM_NAMES(j) == NORM_NAMES(i) )
         {
            </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text"> msg =
               </font><font class="string">&quot;    norm \&quot;&quot;+NORM_NAMES(i)+&quot;</font><font class="text">\</font><font class="string">&quot; is defined several times.&quot;</font><font class="text"> ;
            FE_ComparatorWithAnalytic_ERROR::n0( FIELD-&gt;name(), msg ) ;
         }
         </font><font class="kw1">if</font><font class="text">( NORM_SAVE_NAMES(j) == NORM_SAVE_NAMES(i) )
         {
            </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text"> msg =
               </font><font class="string">&quot;    norm saving names \&quot;&quot;+NORM_SAVE_NAMES(i)
                                       +&quot;</font><font class="text">\</font><font class="string">&quot; is defined several times.&quot;</font><font class="text"> ;
            FE_ComparatorWithAnalytic_ERROR::n0( FIELD-&gt;name(), msg ) ;
         }
      }
   }
   
   </font><font class="kw2">size_t</font><font class="text"> nb_norms = NORM_NAMES.size() ;
   NORMS.re_initialize( nb_norms ) ;
   EXPOS.re_initialize( nb_norms ) ;
   
   MAX_LENN = 0 ;
   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;nb_norms ; ++i )
   {
      NormType nt = Invalid ;
      read_norm( NORM_NAMES( i ), nt, EXPOS( i ), exp ) ;
      add_exponent( EXPOS( i ) ) ;
      NORMS( i ) = nt ;
      </font><font class="kw1">if</font><font class="text">( NORM_NAMES( i ).length() &gt; MAX_LENN )
      {
         MAX_LENN = NORM_NAMES( i ).length() ;
      }
   }
            
   </font><font class="comment">// Solutions :
</font><font class="text">   </font><font class="kw1">if</font><font class="text">( exp-&gt;has_entry( </font><font class="string">&quot;solution&quot;</font><font class="text"> ) )
   {
      SOL = exp-&gt;abstract_data( </font><font class="kw1">this</font><font class="text">, </font><font class="string">&quot;solution&quot;</font><font class="text">, ct ) ;
      cFE-&gt;require_field_calculation( FIELD, </font><font class="kw3">PDE_LocalFE</font><font class="text">::N ) ;
      sFE-&gt;require_field_calculation( FIELD, </font><font class="kw3">PDE_LocalFE</font><font class="text">::node ) ;
      bFE-&gt;require_field_calculation( FIELD, </font><font class="kw3">PDE_LocalFE</font><font class="text">::node ) ;
   }
   </font><font class="kw1">if</font><font class="text">( exp-&gt;has_entry( </font><font class="string">&quot;d_solution&quot;</font><font class="text"> ) )
   {
      DSOL = exp-&gt;abstract_data( </font><font class="kw1">this</font><font class="text">, </font><font class="string">&quot;d_solution&quot;</font><font class="text">, ct ) ;
      cFE-&gt;require_field_calculation( FIELD, </font><font class="kw3">PDE_LocalFE</font><font class="text">::dN ) ;
   }
   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;NORMS.size() ; ++i )
   {
      NormType nt = (NormType) NORMS(i) ;
      </font><font class="kw1">if</font><font class="text">( nt == err_Linf || nt == sol_Linf || nt == err_Lp || nt == sol_Lp ||
          nt == eip_Lp || nt == err_LpD || nt == err_W1p || nt == sol_W1p || 
          nt == eip_W1p || nt == err_H1D || nt == err_H1DirD )
      {
         </font><font class="kw1">if</font><font class="text">( SOL==0 )
         {
            </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text"> msg =
               </font><font class="string">&quot;    \&quot;</font><font class="text">solution\</font><font class="string">&quot; expected to compute the requested norms&quot;</font><font class="text"> ;
            FE_ComparatorWithAnalytic_ERROR::n0( FIELD-&gt;name(), msg ) ;
         }
      }
      </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( nt == err_sW1p || nt == sol_sW1p || nt == eip_sW1p || 
               nt == err_W1p || nt == sol_W1p || nt == eip_W1p )
      {
         </font><font class="kw1">if</font><font class="text">( DSOL==0 )
         {
            </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text"> msg =
               </font><font class="string">&quot;    \&quot;</font><font class="text">d_solution\</font><font class="string">&quot; expected  to compute the requested norms&quot;</font><font class="text"> ;
            FE_ComparatorWithAnalytic_ERROR::n0( FIELD-&gt;name(), msg ) ;
         }
      }
   }
   
   </font><font class="comment">// Check solution :
</font><font class="text">   </font><font class="kw1">if</font><font class="text">( SOL!=0 )
   {
      </font><font class="kw1">if</font><font class="text">( !SOL-&gt;value_can_be_evaluated() )
      {
         </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_not_evaluable(
                        exp, </font><font class="string">&quot;solution&quot;</font><font class="text">, SOL-&gt;undefined_variables() ) ;
      }
      </font><font class="kw1">if</font><font class="text">( SOL-&gt;data_type()!=</font><font class="kw3">PEL_Data</font><font class="text">::DoubleVector )
      {
         </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_bad_data_type(
            exp, </font><font class="string">&quot;solution&quot;</font><font class="text">, </font><font class="kw3">PEL_Data</font><font class="text">::DoubleVector ) ;
         
      }
   }
   </font><font class="kw1">if</font><font class="text">( DSOL!=0 )
   {
      </font><font class="kw1">if</font><font class="text">( !DSOL-&gt;value_can_be_evaluated() )
      {
         </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_not_evaluable(
                     exp, </font><font class="string">&quot;d_solution&quot;</font><font class="text">, DSOL-&gt;undefined_variables() ) ;
      }
      </font><font class="kw1">if</font><font class="text">( DSOL-&gt;data_type()!=</font><font class="kw3">PEL_Data</font><font class="text">::DoubleArray2D )
      {
         </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_bad_data_type(
            exp, </font><font class="string">&quot;d_solution&quot;</font><font class="text">, </font><font class="kw3">PEL_Data</font><font class="text">::DoubleArray2D ) ;
      }
   }

   </font><font class="kw1">if</font><font class="text">( exp-&gt;has_entry( </font><font class="string">&quot;reference_distance&quot;</font><font class="text"> ) )
   {
      exp-&gt;test_data( </font><font class="string">&quot;reference_distance&quot;</font><font class="text">, </font><font class="string">&quot;reference_distance&gt;0.&quot;</font><font class="text"> ) ;
   }

   </font><font class="comment">// Post-processing initialization:
</font><font class="text">   </font><font class="kw1">if</font><font class="text">( COM-&gt;rank()==0 &amp;&amp; !FILE_OUT.empty() )
   {
      </font><font class="kw1">static</font><font class="text"> </font><font class="kw3">stringVector</font><font class="text"> FILE_NAMES( 0 ) ;
      </font><font class="kw1">if</font><font class="text">( !FILE_NAMES.has( FILE_OUT ) )
      {
         FILE_NAMES.append( FILE_OUT ) ;
         </font><font class="kw2">std</font><font class="text">::ofstream ofs ;
         ofs.open( FILE_OUT.c_str(), </font><font class="kw2">std</font><font class="text">::ios::out | </font><font class="kw2">std</font><font class="text">::ios::trunc ) ;
         </font><font class="kw1">if</font><font class="text">( !ofs ) FE_ComparatorWithAnalytic_ERROR::n3( FILE_OUT ) ;
         ofs &lt;&lt; </font><font class="string">&quot;#&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
         ofs &lt;&lt; </font><font class="string">&quot;# FE_ComparatorWithAnalytic generated file&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
         ofs &lt;&lt; </font><font class="string">&quot;# meaning of the columns:&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
         ofs &lt;&lt; </font><font class="string">&quot;#    TIME : current time&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
         ofs &lt;&lt; </font><font class="string">&quot;#    TIST : time step&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
         ofs &lt;&lt; </font><font class="string">&quot;#    XH   : maximum of the cell diameters&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
         ofs &lt;&lt; </font><font class="string">&quot;#    XD   : maximum of the cell equivalent ball diameters&quot;</font><font class="text"> 
             &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
         ofs &lt;&lt; </font><font class="string">&quot;#    other columns : given by the data of keyword&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
         ofs &lt;&lt; </font><font class="string">&quot;#                    \&quot;</font><font class="text">norm_saving_names\</font><font class="string">&quot; in the data deck&quot;
</font><font class="text">             &lt;&lt; </font><font class="kw2">endl</font><font class="text"> &lt;&lt; </font><font class="string">&quot;#&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
         ofs &lt;&lt; </font><font class="string">&quot;#       TIME         TIST           XH           XD &quot;</font><font class="text"> ;
         </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;NORMS.size() ; ++i )
         {
            ofs &lt;&lt; </font><font class="kw2">setw</font><font class="text">( 12 ) &lt;&lt; NORM_SAVE_NAMES(i) &lt;&lt; </font><font class="string">&quot; &quot;</font><font class="text"> ;
         }
         ofs &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
         ofs.close() ;
      }
   }
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: do_before_time_stepping(
                                           </font><font class="kw3">FE_TimeIterator</font><font class="text"> </font><font class="kw1">const</font><font class="text">* t_it ) 
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: do_before_time_stepping&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( do_before_time_stepping_PRE( t_it ) ) ;

   </font><font class="kw1">if</font><font class="text">( SAVING_TIMES.size() != 0 )
   {
      </font><font class="kw1">if</font><font class="text">( !t_it-&gt;table_of_times_is_valid( SAVING_TIMES ) )
      {
         t_it-&gt;raise_invalid_table_of_times( </font><font class="string">&quot;FE_ComparatorWithAnalytic&quot;</font><font class="text">, 
                                             </font><font class="string">&quot;saving_times&quot;</font><font class="text">, 
                                             SAVING_TIMES ) ;
      }
      SAVING_NUMBER = 0 ;
      </font><font class="kw1">if</font><font class="text">( SAVING_TIMES(0) == t_it-&gt;time() )
      {
         save_norms( t_it, 0 ) ;
      }
      NEXT_SAVING_TIME = t_it-&gt;next_time_in_table( SAVING_TIMES ) ;
   }

   </font><font class="comment">// Check solution dimensions :
</font><font class="text">   TT-&gt;</font><font class="kw2">set</font><font class="text">( t_it-&gt;time() ) ;
   cFE-&gt;start() ;
   COORDS-&gt;</font><font class="kw2">set</font><font class="text">( cFE-&gt;polyhedron()-&gt;center()-&gt;coordinate_vector() ) ;
   </font><font class="kw1">if</font><font class="text">( SOL!=0 )
   {
      </font><font class="kw3">doubleVector</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; theo = SOL-&gt;to_double_vector() ;
      </font><font class="kw1">if</font><font class="text">( theo.size() != FIELD-&gt;nb_components() )
      {
         </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text"> msg =
            </font><font class="string">&quot;    Bad size for table \&quot;</font><font class="text">solution\</font><font class="string">&quot;.&quot;</font><font class="text"> ;
         FE_ComparatorWithAnalytic_ERROR::n0( FIELD-&gt;name(), msg ) ;
      }
   }
   </font><font class="kw1">if</font><font class="text">( DSOL != 0 )
   {
      </font><font class="kw3">doubleArray2D</font><font class="text"> d_theo = DSOL-&gt;to_double_array2D() ;
      </font><font class="kw1">if</font><font class="text">( d_theo.index_bound(0) != FIELD-&gt;nb_components() ||
          d_theo.index_bound(1) != cFE-&gt;nb_space_dimensions() )
      {
         </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text"> msg =
            </font><font class="string">&quot;    Bad size for table \&quot;</font><font class="text">d_solution\</font><font class="string">&quot;.&quot;</font><font class="text"> ;
         FE_ComparatorWithAnalytic_ERROR::n0( FIELD-&gt;name(), msg ) ;
      }
   }
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: do_one_inner_iteration(
                                           </font><font class="kw3">FE_TimeIterator</font><font class="text"> </font><font class="kw1">const</font><font class="text">* t_it ) 
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: do_one_inner_iteration&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( do_one_inner_iteration_PRE( t_it ) ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: do_after_time_adaptation(
                                           </font><font class="kw3">FE_TimeIterator</font><font class="text"> </font><font class="kw1">const</font><font class="text">* t_it ) 
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: do_after_time_adaptation&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( do_after_time_adaptation_PRE( t_it ) ) ;
   
   </font><font class="kw1">if</font><font class="text">( SAVING_TIMES.size() != 0 )
   {
      </font><font class="kw1">if</font><font class="text">( </font><font class="kw3">FE_TimeIterator</font><font class="text">::greater_or_equal( t_it-&gt;time(),
                                             NEXT_SAVING_TIME ) )
      {
         start_total_timer( 
               </font><font class="string">&quot;FE_ComparatorWithAnalytic:: do_after_time_adaptation&quot;</font><font class="text"> ) ;
         
         save_norms( t_it, 0 ) ;
         NEXT_SAVING_TIME = t_it-&gt;next_time_in_table( SAVING_TIMES ) ;
         
         stop_total_timer() ;      
      }
   }
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: save_other_than_time_and_fields(
                                                 </font><font class="kw3">FE_TimeIterator</font><font class="text"> </font><font class="kw1">const</font><font class="text">* t_it,  
                                                 </font><font class="kw3">PDE_ResultSaver</font><font class="text">* rs )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: save_other_than_time_and_fields&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_PRE</font><font class="text">( save_other_than_time_and_fields_PRE( t_it, rs ) ) ;
   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;

   </font><font class="kw1">if</font><font class="text">( SAVING_TIMES.size() == 0 )
   {
      start_total_timer( 
            </font><font class="string">&quot;FE_ComparatorWithAnalytic:: save_other_than_time_and_fields&quot;</font><font class="text"> ) ;
      
      save_norms( t_it, rs ) ;
      
      stop_total_timer() ;
   }      
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: print( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">ostream</font><font class="text">&amp; os,
                                   </font><font class="kw2">size_t</font><font class="text"> indent_width ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: print&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;

   </font><font class="kw3">FE_OneStepIteration</font><font class="text">::print( os, indent_width ) ;
   
   </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text"> s( indent_width+3, </font><font class="string">' '</font><font class="text"> ) ;
   os &lt;&lt; s &lt;&lt; </font><font class="string">&quot;field : \&quot;&quot; &lt;&lt; FIELD-&gt;name() &lt;&lt; &quot;</font><font class="text">\</font><font class="string">&quot;&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
   os &lt;&lt; s &lt;&lt; </font><font class="string">&quot;time step saved in \&quot;</font><font class="text">TIST\</font><font class="string">&quot;&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
   os &lt;&lt; s &lt;&lt; </font><font class="string">&quot;h (inter vertices distance)  saved in \&quot;</font><font class="text">XH\</font><font class="string">&quot;&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
   os &lt;&lt; s &lt;&lt; </font><font class="string">&quot;h (equivalent ball diameter) saved in \&quot;</font><font class="text">XD\</font><font class="string">&quot;&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
   </font><font class="kw1">if</font><font class="text">( NULLIFY_INTEGRAL )
   {
      os &lt;&lt; s &lt;&lt; </font><font class="string">&quot;nullify integral&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
   }
   
   </font><font class="kw2">size_t</font><font class="text"> lll = 0 ;
   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;NORM_SAVE_NAMES.size() ; ++i )
   {
      </font><font class="kw2">size_t</font><font class="text"> ll = NORM_SAVE_NAMES( i ).length() ;
      </font><font class="kw1">if</font><font class="text">( ll &gt; lll ) lll = ll ;
   }
   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;NORMS.size() ; ++i )
   {
      os &lt;&lt; s &lt;&lt; </font><font class="kw2">setw</font><font class="text">( MAX_LENN+2) &lt;&lt; ( </font><font class="string">&quot;\&quot;&quot; + NORM_NAMES( i ) +&quot;</font><font class="text">\</font><font class="string">&quot;&quot;</font><font class="text">) 
         &lt;&lt; </font><font class="string">&quot;  saved in  &quot;</font><font class="text"> 
         &lt;&lt; </font><font class="kw2">setw</font><font class="text">( lll+2 ) &lt;&lt; ( </font><font class="string">&quot;\&quot;&quot; + NORM_SAVE_NAMES(i) + &quot;</font><font class="text">\</font><font class="string">&quot;&quot;</font><font class="text"> ) ; 
      </font><font class="kw1">if</font><font class="text">( EXPOS( i ) != </font><font class="kw3">PEL</font><font class="text">::bad_double() )
      {
         os &lt;&lt; </font><font class="string">&quot; (exponent: &quot;</font><font class="text"> &lt;&lt; EXPOS( i ) &lt;&lt; </font><font class="string">&quot;)&quot;</font><font class="text"> ;
      }
      os &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
   }
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: save_norms( </font><font class="kw3">FE_TimeIterator</font><font class="text"> </font><font class="kw1">const</font><font class="text">* t_it,  
                                        </font><font class="kw3">PDE_ResultSaver</font><font class="text">* rs )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: save_norms&quot;</font><font class="text"> ) ;

   </font><font class="kw1">bool</font><font class="text"> has_ofs = </font><font class="kw1">false</font><font class="text"> ;
   </font><font class="kw2">std</font><font class="text">::ofstream ofs ;
   </font><font class="kw1">if</font><font class="text">( COM-&gt;rank()==0 &amp;&amp; !FILE_OUT.empty() )
   {
      ofs.open( FILE_OUT.c_str(), </font><font class="kw2">std</font><font class="text">::ios::out | </font><font class="kw2">std</font><font class="text">::ios::app ) ;
      ofs.setf( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">ios_base</font><font class="text">::</font><font class="kw2">uppercase</font><font class="text"> | </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">ios_base</font><font class="text">::</font><font class="kw2">scientific</font><font class="text"> ) ;
      ofs &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">setprecision</font><font class="text">( 5 ) ;
      has_ofs = </font><font class="kw1">true</font><font class="text"> ;
   }

   </font><font class="kw1">double</font><font class="text"> </font><font class="kw1">const</font><font class="text"> h = max_inter_vertices_distance_of_cells() ;
   </font><font class="kw1">double</font><font class="text"> </font><font class="kw1">const</font><font class="text"> d = max_equivalent_ball_diameter_of_cells() ;
   </font><font class="kw1">if</font><font class="text">( rs != 0 )
   {
      </font><font class="kw1">if</font><font class="text">( !rs-&gt;has_variable( </font><font class="string">&quot;TIST&quot;</font><font class="text"> ) )
      {
         rs-&gt;save_variable( t_it-&gt;time_step(), </font><font class="string">&quot;TIST&quot;</font><font class="text"> ) ;
      }
      </font><font class="kw1">if</font><font class="text">( !rs-&gt;has_variable( </font><font class="string">&quot;XH&quot;</font><font class="text"> ) )
      {
         rs-&gt;save_variable( h, </font><font class="string">&quot;XH&quot;</font><font class="text"> ) ;
      }
      </font><font class="kw1">if</font><font class="text">( !rs-&gt;has_variable( </font><font class="string">&quot;XD&quot;</font><font class="text"> ) )
      {
         rs-&gt;save_variable( d, </font><font class="string">&quot;XD&quot;</font><font class="text"> ) ;
      }
   }
   </font><font class="kw1">if</font><font class="text">( has_ofs )
   {
      ofs &lt;&lt; </font><font class="kw2">setw</font><font class="text">( 12 ) &lt;&lt; t_it-&gt;time() &lt;&lt; </font><font class="string">&quot; &quot;</font><font class="text"> ;
      ofs &lt;&lt; </font><font class="kw2">setw</font><font class="text">( 12 ) &lt;&lt; t_it-&gt;time_step() &lt;&lt; </font><font class="string">&quot; &quot;</font><font class="text"> ;
      ofs &lt;&lt; </font><font class="kw2">setw</font><font class="text">( 12 ) &lt;&lt; h &lt;&lt; </font><font class="string">&quot; &quot;</font><font class="text"> ;
      ofs &lt;&lt; </font><font class="kw2">setw</font><font class="text">( 12 ) &lt;&lt; d &lt;&lt; </font><font class="string">&quot; &quot;</font><font class="text"> ;
   }

   </font><font class="kw1">if</font><font class="text">( verbose_level() != 0 )
   {
      increase_indent() ;
      </font><font class="kw1">if</font><font class="text">( t_it-&gt;is_started() )
      {
         </font><font class="kw3">PEL</font><font class="text">::out() &lt;&lt; indent() &lt;&lt; </font><font class="string">&quot;time step : &quot;</font><font class="text"> &lt;&lt; t_it-&gt;time_step()
                    &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
      }
      </font><font class="kw3">PEL</font><font class="text">::out() &lt;&lt; indent() &lt;&lt; </font><font class="string">&quot;h (inter vertices distance)  : &quot;
</font><font class="text">                 &lt;&lt; h &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
      </font><font class="kw3">PEL</font><font class="text">::out() &lt;&lt; indent() &lt;&lt; </font><font class="string">&quot;h (equivalent ball diameter) : &quot;
</font><font class="text">                 &lt;&lt; d &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
      decrease_indent() ;
   }

   </font><font class="kw3">doubleVector</font><font class="text"> norm_values( NORMS.size() ) ;
   compute_norms( t_it, norm_values ) ;
   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;NORMS.size() ; ++i )
   {
      </font><font class="kw1">if</font><font class="text">( rs != 0 )
      {
         </font><font class="kw1">if</font><font class="text">( rs-&gt;has_variable( NORM_SAVE_NAMES(i) ) )
            FE_ComparatorWithAnalytic_ERROR::n1( NORM_SAVE_NAMES(i) ) ;
         rs-&gt;save_variable( norm_values(i), NORM_SAVE_NAMES(i) ) ;
      }
      </font><font class="kw1">if</font><font class="text">( has_ofs ) ofs &lt;&lt; </font><font class="kw2">setw</font><font class="text">( 12 ) &lt;&lt; norm_values(i) &lt;&lt; </font><font class="string">&quot; &quot;</font><font class="text"> ;
   }

   </font><font class="kw1">if</font><font class="text">( has_ofs ) 
   {
      ofs &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
      ofs.close() ;
   }
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: compute_norms( </font><font class="kw3">FE_TimeIterator</font><font class="text"> </font><font class="kw1">const</font><font class="text">* t_it,
                                           </font><font class="kw3">doubleVector</font><font class="text">&amp; norm_values )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: compute_norms&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK</font><font class="text">( t_it != 0 ) ;
   </font><font class="kw3">PEL_CHECK</font><font class="text">( norm_values.size() == NORMS.size() ) ;
   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;
   
   TT-&gt;</font><font class="kw2">set</font><font class="text">( t_it-&gt;time() ) ;

   </font><font class="kw1">double</font><font class="text"> sol_shift = 0.0 ;
   </font><font class="kw1">double</font><font class="text"> app_shift = 0.0 ;
   compute_shift( sol_shift, app_shift ) ;
   
   </font><font class="kw1">double</font><font class="text"> x_sol_Linf = </font><font class="kw3">PEL</font><font class="text">::bad_double() ;
   </font><font class="kw1">double</font><font class="text"> x_err_Linf = </font><font class="kw3">PEL</font><font class="text">::bad_double() ;
   
   </font><font class="kw2">size_t</font><font class="text"> nbn = nb_exponents() ;
   </font><font class="kw3">doubleVector</font><font class="text"> x_sol_Lp( nbn ) ; x_sol_Lp.</font><font class="kw2">set</font><font class="text">( </font><font class="kw3">PEL</font><font class="text">::bad_double() ) ;
   </font><font class="kw3">doubleVector</font><font class="text"> x_eip_Lp( nbn ) ; x_eip_Lp.</font><font class="kw2">set</font><font class="text">( </font><font class="kw3">PEL</font><font class="text">::bad_double() ) ;
   </font><font class="kw3">doubleVector</font><font class="text"> x_err_Lp( nbn ) ; x_err_Lp.</font><font class="kw2">set</font><font class="text">( </font><font class="kw3">PEL</font><font class="text">::bad_double() ) ;

   </font><font class="kw3">doubleVector</font><font class="text"> x_err_LpD( nbn ) ; x_err_LpD.</font><font class="kw2">set</font><font class="text">( </font><font class="kw3">PEL</font><font class="text">::bad_double() ) ;

   </font><font class="kw3">doubleVector</font><font class="text"> x_sol_sW1p( nbn ) ; x_sol_sW1p.</font><font class="kw2">set</font><font class="text">( </font><font class="kw3">PEL</font><font class="text">::bad_double() ) ;
   </font><font class="kw3">doubleVector</font><font class="text"> x_eip_sW1p( nbn ) ; x_eip_sW1p.</font><font class="kw2">set</font><font class="text">( </font><font class="kw3">PEL</font><font class="text">::bad_double() ) ;
   </font><font class="kw3">doubleVector</font><font class="text"> x_err_sW1p( nbn ) ; x_err_sW1p.</font><font class="kw2">set</font><font class="text">( </font><font class="kw3">PEL</font><font class="text">::bad_double() ) ;
   
   </font><font class="kw1">double</font><font class="text"> x_err_H1D = </font><font class="kw3">PEL</font><font class="text">::bad_double() ;
   </font><font class="kw1">double</font><font class="text"> x_err_H1DirD = </font><font class="kw3">PEL</font><font class="text">::bad_double() ;
   
   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;NORMS.size() ; ++i )
   {
      NormType </font><font class="kw1">const</font><font class="text"> norm = (NormType) NORMS( i ) ;
      </font><font class="kw1">double</font><font class="text"> pp = EXPOS( i ) ;
      </font><font class="kw2">size_t</font><font class="text"> p = idx_of_exponent( pp ) ;
      </font><font class="kw1">if</font><font class="text">( ( norm == sol_Linf || norm == err_Linf ) &amp;&amp;  
          x_sol_Linf == </font><font class="kw3">PEL</font><font class="text">::bad_double() )
      {
         calc_Linf( sol_shift, app_shift, x_sol_Linf, x_err_Linf ) ;
      }
      </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( ( norm == sol_Lp || norm == eip_Lp || norm == err_Lp ) &amp;&amp;
               x_sol_Lp( p ) == </font><font class="kw3">PEL</font><font class="text">::bad_double() )
      {
         calc_Lp( sol_shift, app_shift, pp, 
                  x_sol_Lp( p ), x_eip_Lp( p ), x_err_Lp( p ) ) ;
      }
      </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( ( norm == err_LpD ) &amp;&amp; 
               x_err_LpD( p ) == </font><font class="kw3">PEL</font><font class="text">::bad_double() )
      {
         calc_LpD( sol_shift, app_shift, pp, x_err_LpD( p ) ) ;
      }
      </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( ( norm == sol_sW1p || norm == eip_sW1p || norm == err_sW1p ) &amp;&amp;
               x_sol_sW1p( p ) == </font><font class="kw3">PEL</font><font class="text">::bad_double() )
      {
         calc_sW1p( pp, x_sol_sW1p( p ), x_eip_sW1p( p ), x_err_sW1p( p ) ) ;
      }
      </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( norm == sol_W1p || norm == eip_W1p || norm == err_W1p )
      {
         </font><font class="kw1">if</font><font class="text">( x_sol_Lp( p ) == </font><font class="kw3">PEL</font><font class="text">::bad_double() )
         {
            calc_Lp( sol_shift, app_shift, pp, 
                     x_sol_Lp( p ), x_eip_Lp( p ), x_err_Lp( p ) ) ;
         }
         </font><font class="kw1">if</font><font class="text">( x_sol_sW1p( p ) == </font><font class="kw3">PEL</font><font class="text">::bad_double() )
         {
            calc_sW1p( pp, 
                       x_sol_sW1p( p ), x_eip_sW1p( p ), x_err_sW1p( p ) ) ;
         }
      }
   }
   
   </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;NORMS.size() ; ++i )
   {
      NormType </font><font class="kw1">const</font><font class="text"> norm = (NormType) NORMS( i ) ;
      </font><font class="kw1">double</font><font class="text"> pp = EXPOS( i ) ;
      </font><font class="kw2">size_t</font><font class="text"> p = idx_of_exponent( pp ) ;
      norm_values( i ) = -</font><font class="kw3">PEL</font><font class="text">::max_double() ;
      </font><font class="kw1">switch</font><font class="text">( norm )
      {
         </font><font class="kw1">case</font><font class="text"> err_Linf :
            norm_values( i ) = x_err_Linf ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">case</font><font class="text"> sol_Linf :
            norm_values( i ) = x_sol_Linf ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">case</font><font class="text"> err_Lp :
            norm_values( i ) = </font><font class="kw3">PEL</font><font class="text">::pow( x_err_Lp( p ), 1.0/pp ) ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">case</font><font class="text"> err_LpD :
            norm_values( i ) = </font><font class="kw3">PEL</font><font class="text">::pow( x_err_LpD( p ), 1.0/pp ) ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">case</font><font class="text"> sol_Lp :
            norm_values( i ) = </font><font class="kw3">PEL</font><font class="text">::pow( x_sol_Lp( p ), 1.0/pp ) ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">case</font><font class="text"> eip_Lp :
            norm_values( i ) = </font><font class="kw3">PEL</font><font class="text">::pow( x_eip_Lp( p ), 1.0/pp ) ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">case</font><font class="text"> err_sW1p :
            norm_values( i ) = </font><font class="kw3">PEL</font><font class="text">::pow( x_err_sW1p( p ), 1.0/pp ) ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">case</font><font class="text"> err_H1D :
            </font><font class="kw1">if</font><font class="text">( x_err_H1D == </font><font class="kw3">PEL</font><font class="text">::bad_double() )
            {
               calc_H1D( x_err_H1D ) ;
            }
            norm_values( i ) = </font><font class="kw3">PEL</font><font class="text">::sqrt( x_err_H1D ) ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">case</font><font class="text"> err_H1DirD :
            </font><font class="kw1">if</font><font class="text">( x_err_H1DirD == </font><font class="kw3">PEL</font><font class="text">::bad_double() )
            {
               calc_H1DirD( x_err_H1DirD ) ;
            }
            norm_values( i ) = </font><font class="kw3">PEL</font><font class="text">::sqrt( x_err_H1DirD ) ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">case</font><font class="text"> sol_sW1p :
            norm_values( i ) = </font><font class="kw3">PEL</font><font class="text">::pow( x_sol_sW1p( p ), 1.0/pp ) ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">case</font><font class="text"> eip_sW1p :
            norm_values( i ) = </font><font class="kw3">PEL</font><font class="text">::pow( x_eip_sW1p( p ), 1.0/pp  ) ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">case</font><font class="text"> err_W1p :
            norm_values( i ) = </font><font class="kw3">PEL</font><font class="text">::pow( x_err_Lp( p ) + x_err_sW1p( p ), 
                                         1.0/pp ) ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">case</font><font class="text"> sol_W1p :
            norm_values( i ) = </font><font class="kw3">PEL</font><font class="text">::pow( x_sol_Lp( p ) + x_sol_sW1p( p ), 
                                         1.0/pp ) ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">case</font><font class="text"> eip_W1p :
            norm_values( i ) = </font><font class="kw3">PEL</font><font class="text">::pow( x_eip_Lp( p ) + x_eip_sW1p( p ), 
                                         1.0/pp ) ;
            </font><font class="kw1">break</font><font class="text"> ;
         </font><font class="kw1">default</font><font class="text"> :
            </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_internal(
               </font><font class="string">&quot;*** FE_ComparatorWithAnalytic error :\n&quot;
</font><font class="text">               </font><font class="string">&quot;    try to use a norm which is not implemented.&quot;</font><font class="text"> ) ;
      }
   }

   </font><font class="kw1">if</font><font class="text">( verbose_level() != 0 )
   {
      </font><font class="kw2">ios_base</font><font class="text">::</font><font class="kw2">fmtflags</font><font class="text"> original_flags = </font><font class="kw3">PEL</font><font class="text">::out().</font><font class="kw2">flags</font><font class="text">() ;
      </font><font class="kw3">PEL</font><font class="text">::out().setf( </font><font class="kw2">ios_base</font><font class="text">::</font><font class="kw2">uppercase</font><font class="text"> | </font><font class="kw2">ios_base</font><font class="text">::</font><font class="kw2">scientific</font><font class="text"> ) ;
      increase_indent() ;
      </font><font class="kw3">PEL</font><font class="text">::out() &lt;&lt; indent() &lt;&lt; </font><font class="string">&quot;field : \&quot;&quot; &lt;&lt; FIELD-&gt;name() &lt;&lt; &quot;</font><font class="text">\</font><font class="string">&quot;&quot;
</font><font class="text">                 &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
      </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;NORM_NAMES.size() ; ++i )
      {
         </font><font class="kw3">PEL</font><font class="text">::out() &lt;&lt; indent() &lt;&lt; </font><font class="kw2">setw</font><font class="text">( MAX_LENN+1) &lt;&lt; NORM_NAMES( i )
                    &lt;&lt; </font><font class="string">&quot; : &quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">setprecision</font><font class="text">( 8 ) &lt;&lt; </font><font class="kw2">setw</font><font class="text">( 15 ) 
                    &lt;&lt; norm_values( i ) &lt;&lt; </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">endl</font><font class="text"> ;
      }
      decrease_indent() ;
      </font><font class="kw3">PEL</font><font class="text">::out().</font><font class="kw2">flags</font><font class="text">( original_flags ) ;
   }
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: calc_Linf( </font><font class="kw1">double</font><font class="text"> sol_shift, </font><font class="kw1">double</font><font class="text"> app_shift,
                                       </font><font class="kw1">double</font><font class="text">&amp; sol_norm, </font><font class="kw1">double</font><font class="text">&amp; err_norm )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: calc_Linf&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;

   err_norm = 0.0 ;
   sol_norm = 0.0 ;

   </font><font class="kw2">size_t</font><font class="text"> </font><font class="kw1">const</font><font class="text"> nbc = FIELD-&gt;nb_components() ;
   
   </font><font class="kw1">for</font><font class="text">( cFE-&gt;start() ; cFE-&gt;is_valid() ; cFE-&gt;go_next() )
   {
      </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> loc_n=0 ; loc_n &lt; cFE-&gt;nb_local_nodes( FIELD ) ; ++loc_n )
      {
         </font><font class="kw1">if</font><font class="text">( cFE-&gt;local_node_is_in_mesh( FIELD, loc_n ) )
         {
            cFE-&gt;set_calculation_point( 
                              cFE-&gt;local_node_location( FIELD, loc_n ) ) ;
            </font><font class="kw3">doubleVector</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; dv = 
                              cFE-&gt;calculation_point()-&gt;coordinate_vector() ;
            COORDS-&gt;</font><font class="kw2">set</font><font class="text">( dv ) ;
            </font><font class="kw3">doubleVector</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; theo = SOL-&gt;to_double_vector() ;
            </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> ic=0 ; ic&lt;nbc ; ++ic   )
            {
               </font><font class="kw1">double</font><font class="text"> app = cFE-&gt;value_at_pt( FIELD, LEVEL, ic )-app_shift ;
               </font><font class="kw1">double</font><font class="text"> sol = theo( ic ) - sol_shift ;
               err_norm = </font><font class="kw3">PEL</font><font class="text">::max( err_norm, </font><font class="kw3">PEL</font><font class="text">::abs( sol - app ) ) ;
               sol_norm = </font><font class="kw3">PEL</font><font class="text">::max( sol_norm, </font><font class="kw3">PEL</font><font class="text">::abs( sol       ) ) ;
            }
         }
      }
   }
   err_norm = COM-&gt;max( err_norm ) ;
   sol_norm = COM-&gt;max( sol_norm   ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: calc_Lp( 
                 </font><font class="kw1">double</font><font class="text"> sol_shift, </font><font class="kw1">double</font><font class="text"> app_shift, </font><font class="kw1">double</font><font class="text"> exponent,                    
                 </font><font class="kw1">double</font><font class="text">&amp; sol_norm, </font><font class="kw1">double</font><font class="text">&amp; eip_norm, </font><font class="kw1">double</font><font class="text">&amp; err_norm )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: calc_Lp&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;

   sol_norm = 0.0 ;
   eip_norm = 0.0 ; 
   err_norm = 0.0 ;

   </font><font class="kw2">size_t</font><font class="text"> </font><font class="kw1">const</font><font class="text"> nbc = FIELD-&gt;nb_components() ;
   </font><font class="kw3">doubleVector</font><font class="text"> inter( nbc ) ;
 
   </font><font class="kw1">for</font><font class="text">( cFE-&gt;start() ; cFE-&gt;is_valid() ; cFE-&gt;go_next() )
   {
      cFE-&gt;set_row_and_col_fields( FIELD, FIELD ) ;
      cFE-&gt;start_IP_iterator( QRP ) ;
      </font><font class="kw1">for</font><font class="text">( ; cFE-&gt;valid_IP() ; cFE-&gt;go_next_IP() )
      {
         inter.</font><font class="kw2">set</font><font class="text">( 0.0 ) ;
         </font><font class="kw3">doubleVector</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; N = cFE-&gt;Ns_at_IP( </font><font class="kw3">PDE_LocalFE</font><font class="text">::row ) ;
         </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;N.size() ; ++i )
         {
            </font><font class="kw3">GE_Point</font><font class="text"> </font><font class="kw1">const</font><font class="text">* node = cFE-&gt;local_node_location( FIELD, i ) ;
            COORDS-&gt;</font><font class="kw2">set</font><font class="text">( node-&gt;coordinate_vector() ) ;
            </font><font class="kw3">doubleVector</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; sol_at_node = SOL-&gt;to_double_vector() ;
            </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> ic=0 ; ic&lt;nbc ; ++ic   )
            {
               </font><font class="comment">//????? a sortir de la boucle ????????????????????????????,
</font><font class="text">               inter( ic ) += sol_at_node( ic ) * N( i ) ;
            }
         }

         </font><font class="kw3">doubleVector</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; dv =
                             cFE-&gt;coordinates_of_IP()-&gt;coordinate_vector() ;
         COORDS-&gt;</font><font class="kw2">set</font><font class="text">( dv ) ;
         </font><font class="kw1">double</font><font class="text"> weight = cFE-&gt;weight_of_IP() ;
         </font><font class="kw1">if</font><font class="text">( </font><font class="kw3">FE</font><font class="text">::geometry() == </font><font class="kw3">FE</font><font class="text">::axisymmetrical )
         {
            weight *= dv( 0 ) ;
         }
         </font><font class="kw3">doubleVector</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; theo = SOL-&gt;to_double_vector() ;
         </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> ic=0 ; ic&lt;nbc ; ++ic   )
         {
            </font><font class="kw1">double</font><font class="text"> app = cFE-&gt;value_at_IP( FIELD, LEVEL, ic ) - app_shift ;
            </font><font class="kw1">double</font><font class="text"> sol = theo( ic ) - sol_shift ;
            </font><font class="kw1">double</font><font class="text"> eip = sol - inter( ic ) ;
            </font><font class="kw1">double</font><font class="text"> err = sol - app ;
            sol_norm += weight * </font><font class="kw3">PEL</font><font class="text">::pow( </font><font class="kw3">PEL</font><font class="text">::abs( sol ), exponent ) ;
            eip_norm += weight * </font><font class="kw3">PEL</font><font class="text">::pow( </font><font class="kw3">PEL</font><font class="text">::abs( eip ), exponent ) ;
            err_norm += weight * </font><font class="kw3">PEL</font><font class="text">::pow( </font><font class="kw3">PEL</font><font class="text">::abs( err ), exponent ) ;
         }
      }
   }
   sol_norm = COM-&gt;sum( sol_norm ) ;
   eip_norm = COM-&gt;sum( eip_norm ) ;
   err_norm = COM-&gt;sum( err_norm ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: calc_sW1p( </font><font class="kw1">double</font><font class="text"> exponent,
                                       </font><font class="kw1">double</font><font class="text">&amp; sol_snorm,
                                       </font><font class="kw1">double</font><font class="text">&amp; eip_snorm,
                                       </font><font class="kw1">double</font><font class="text">&amp; err_snorm )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: calc_sW1p&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;
   
   sol_snorm = 0.0 ;
   eip_snorm = 0.0 ;
   err_snorm = 0.0 ;

   </font><font class="kw2">size_t</font><font class="text"> </font><font class="kw1">const</font><font class="text"> nbc = FIELD-&gt;nb_components() ;
   </font><font class="kw2">size_t</font><font class="text"> </font><font class="kw1">const</font><font class="text"> nb_dims = cFE-&gt;nb_space_dimensions() ;
   </font><font class="kw3">doubleArray2D</font><font class="text"> inter( nbc, nb_dims ) ;
  
   </font><font class="kw1">for</font><font class="text">( cFE-&gt;start() ; cFE-&gt;is_valid() ; cFE-&gt;go_next() )
   {
      cFE-&gt;set_row_and_col_fields( FIELD, FIELD ) ;
      cFE-&gt;start_IP_iterator( QRP ) ;
      </font><font class="kw1">for</font><font class="text">( ; cFE-&gt;valid_IP() ; cFE-&gt;go_next_IP() )
      { 
         inter.</font><font class="kw2">set</font><font class="text">( 0.0 ) ;
         </font><font class="kw3">doubleArray2D</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; dN = cFE-&gt;dNs_at_IP( </font><font class="kw3">PDE_LocalFE</font><font class="text">::row ) ;
         </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> i=0 ; i&lt;dN.index_bound(0) ; ++i )
         {
            </font><font class="kw3">GE_Point</font><font class="text"> </font><font class="kw1">const</font><font class="text">* node = cFE-&gt;local_node_location( FIELD, i ) ;
            COORDS-&gt;</font><font class="kw2">set</font><font class="text">( node-&gt;coordinate_vector() ) ;
            </font><font class="kw3">doubleVector</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; sol_at_node = SOL-&gt;to_double_vector() ;
            </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> ic=0 ; ic&lt;nbc ; ++ic   )
            {
               </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> d=0 ; d&lt;nb_dims ; ++d )
               {
                  inter( ic, d ) += sol_at_node( ic )*dN( i, d ) ;
               }
            }
         }

         </font><font class="kw3">doubleVector</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; dv =
                             cFE-&gt;coordinates_of_IP()-&gt;coordinate_vector() ;
         COORDS-&gt;</font><font class="kw2">set</font><font class="text">( dv ) ;
         </font><font class="kw1">double</font><font class="text"> weight = cFE-&gt;weight_of_IP() ;
         </font><font class="kw1">if</font><font class="text">( </font><font class="kw3">FE</font><font class="text">::geometry() == </font><font class="kw3">FE</font><font class="text">::axisymmetrical )
         {
            weight *= dv( 0 ) ;
         }
         </font><font class="kw3">doubleArray2D</font><font class="text"> theo = DSOL-&gt;to_double_array2D() ;
         </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> ic=0 ; ic&lt;nbc ; ++ic   )
         {
            </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> d=0 ; d&lt;nb_dims ; ++d )
            {
               </font><font class="kw1">double</font><font class="text"> app = cFE-&gt;gradient_at_IP( FIELD, LEVEL, d, ic ) ;
               </font><font class="kw1">double</font><font class="text"> sol = theo( ic, d ) ;
               </font><font class="kw1">double</font><font class="text"> eip = sol - inter( ic, d ) ;
               </font><font class="kw1">double</font><font class="text"> err = sol - app ;
               sol_snorm += weight * </font><font class="kw3">PEL</font><font class="text">::pow( </font><font class="kw3">PEL</font><font class="text">::abs( sol ), exponent ) ;
               eip_snorm += weight * </font><font class="kw3">PEL</font><font class="text">::pow( </font><font class="kw3">PEL</font><font class="text">::abs( eip ), exponent ) ;
               err_snorm += weight * </font><font class="kw3">PEL</font><font class="text">::pow( </font><font class="kw3">PEL</font><font class="text">::abs( err ), exponent ) ;
            }
         }
      }
   }
   sol_snorm = COM-&gt;sum( sol_snorm   ) ;
   eip_snorm = COM-&gt;sum( eip_snorm ) ;
   err_snorm = COM-&gt;sum( err_snorm ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: calc_LpD( </font><font class="kw1">double</font><font class="text"> sol_shift, </font><font class="kw1">double</font><font class="text"> app_shift,
                                      </font><font class="kw1">double</font><font class="text"> exponent,
                                      </font><font class="kw1">double</font><font class="text">&amp; err_norm )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: calc_LpD&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;
   
   err_norm = 0.0 ;

   </font><font class="kw2">size_t</font><font class="text"> </font><font class="kw1">const</font><font class="text"> nbc = FIELD-&gt;nb_components() ;
 
   </font><font class="kw1">for</font><font class="text">( cFE-&gt;start() ; cFE-&gt;is_valid() ; cFE-&gt;go_next() )
   {
      </font><font class="kw3">GE_Point</font><font class="text"> </font><font class="kw1">const</font><font class="text">* pt = D_norm_center( cFE-&gt;polyhedron() ) ;
      
      </font><font class="kw1">double</font><font class="text"> vol = </font><font class="kw3">FE</font><font class="text">::cell_measure( cFE ) ;

      COORDS-&gt;</font><font class="kw2">set</font><font class="text">( pt-&gt;coordinate_vector() ) ;
      </font><font class="kw3">doubleVector</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; theo = SOL-&gt;to_double_vector() ;

      check_nb_local_nodes( FIELD, cFE, 1 ) ;
      </font><font class="kw2">size_t</font><font class="text"> n = cFE-&gt;global_node( FIELD, 0 ) ;

      </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> ic=0 ; ic&lt;nbc ; ++ic   )
      {
         </font><font class="kw1">double</font><font class="text"> app = FIELD-&gt;DOF_value( LEVEL, n, ic ) - app_shift ;
         </font><font class="kw1">double</font><font class="text"> sol = theo( ic ) - sol_shift ;
         </font><font class="kw1">double</font><font class="text"> err = sol - app ;
         err_norm += vol * </font><font class="kw3">PEL</font><font class="text">::pow( </font><font class="kw3">PEL</font><font class="text">::abs( err ), exponent ) ;
      }
   }
   err_norm = COM-&gt;sum( err_norm ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: calc_H1D( </font><font class="kw1">double</font><font class="text">&amp; err_norm )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: calc_H1D&quot;</font><font class="text"> ) ;

   </font><font class="kw2">size_t</font><font class="text"> </font><font class="kw1">const</font><font class="text"> nbc = FIELD-&gt;nb_components() ;

   err_norm = 0.0 ;
   </font><font class="kw1">for</font><font class="text">( sFE-&gt;start() ; sFE-&gt;is_valid() ; sFE-&gt;go_next() )
   {
      </font><font class="kw3">PDE_LocalFEcell</font><font class="text"> </font><font class="kw1">const</font><font class="text">* cFE0 = sFE-&gt;adjacent_localFEcell( 0 ) ;
      </font><font class="kw3">PDE_LocalFEcell</font><font class="text"> </font><font class="kw1">const</font><font class="text">* cFE1 = sFE-&gt;adjacent_localFEcell( 1 ) ;

      </font><font class="kw3">GE_Point</font><font class="text"> </font><font class="kw1">const</font><font class="text">* pt0 = cFE0-&gt;polyhedron()-&gt;finite_volume_center() ;
      </font><font class="kw1">if</font><font class="text">( pt0 == 0 ) FE_ComparatorWithAnalytic_ERROR::n2( cFE0-&gt;polyhedron() ) ;
      COORDS-&gt;</font><font class="kw2">set</font><font class="text">( pt0-&gt;coordinate_vector() ) ;
      </font><font class="kw3">doubleVector</font><font class="text"> th0 = SOL-&gt;to_double_vector() ;

      </font><font class="kw3">GE_Point</font><font class="text"> </font><font class="kw1">const</font><font class="text">* pt1 = cFE1-&gt;polyhedron()-&gt;finite_volume_center() ;
      </font><font class="kw1">if</font><font class="text">( pt1 == 0 ) FE_ComparatorWithAnalytic_ERROR::n2( cFE1-&gt;polyhedron() ) ;
      COORDS-&gt;</font><font class="kw2">set</font><font class="text">( pt1-&gt;coordinate_vector() ) ;
      </font><font class="kw3">doubleVector</font><font class="text"> th1 = SOL-&gt;to_double_vector() ;

      check_nb_local_nodes( FIELD, cFE0, 1 ) ;
      check_nb_local_nodes( FIELD, cFE1, 1 ) ;
      </font><font class="kw2">size_t</font><font class="text"> n_0 = cFE0-&gt;global_node( FIELD, 0 ) ;
      </font><font class="kw2">size_t</font><font class="text"> n_1 = cFE1-&gt;global_node( FIELD, 0 ) ;

      </font><font class="kw1">double</font><font class="text"> h = sFE-&gt;distance_to_adjacent_finite_volume_center( 0 ) +
                 sFE-&gt;distance_to_adjacent_finite_volume_center( 1 ) ;
      </font><font class="kw1">double</font><font class="text"> area = </font><font class="kw3">FE</font><font class="text">::side_measure( sFE ) ;

      </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> ic=0 ; ic&lt;nbc ; ++ic )
      {
         </font><font class="kw1">double</font><font class="text"> app0 = FIELD-&gt;DOF_value( LEVEL, n_0, ic ) ;
         </font><font class="kw1">double</font><font class="text"> app1 = FIELD-&gt;DOF_value( LEVEL, n_1, ic ) ;
         </font><font class="kw1">double</font><font class="text"> err = ( app1 - th1( ic ) ) - ( app0 - th0( ic ) ) ;
         err_norm += area/h * </font><font class="kw3">PEL</font><font class="text">::sqr( err ) ;
      }
   }
   err_norm = COM-&gt;sum( err_norm ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: calc_H1DirD( </font><font class="kw1">double</font><font class="text">&amp; err_norm )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: calc_H1DirD&quot;</font><font class="text"> ) ;

   calc_H1D( err_norm ) ;

   </font><font class="kw2">size_t</font><font class="text"> </font><font class="kw1">const</font><font class="text"> nbc = FIELD-&gt;nb_components() ;
   
   </font><font class="kw1">for</font><font class="text">( bFE-&gt;start() ; bFE-&gt;is_valid() ; bFE-&gt;go_next() )
   {
      check_nb_local_nodes( FIELD, bFE, 1 ) ;
      </font><font class="kw2">size_t</font><font class="text"> n = bFE-&gt;global_node( FIELD, 0 ) ;

      </font><font class="kw3">GE_Color</font><font class="text"> </font><font class="kw1">const</font><font class="text">* color = bFE-&gt;color() ;
      </font><font class="kw1">double</font><font class="text"> area = </font><font class="kw3">FE</font><font class="text">::bound_measure( bFE ) ;

      cFE-&gt;go_i_th( bFE-&gt;adjacent_cell_id() ) ;
      </font><font class="kw3">GE_Point</font><font class="text"> </font><font class="kw1">const</font><font class="text">* pt = cFE-&gt;polyhedron()-&gt;finite_volume_center() ;
      </font><font class="kw1">if</font><font class="text">( pt == 0 ) FE_ComparatorWithAnalytic_ERROR::n2( cFE-&gt;polyhedron() ) ;
      COORDS-&gt;</font><font class="kw2">set</font><font class="text">( pt-&gt;coordinate_vector() ) ;
      </font><font class="kw3">doubleVector</font><font class="text"> th = SOL-&gt;to_double_vector() ;

      </font><font class="kw1">for</font><font class="text">( </font><font class="kw2">size_t</font><font class="text"> ic=0 ; ic&lt;nbc ; ++ic )
      {
         </font><font class="kw1">if</font><font class="text">( BCs-&gt;has_BC( color, FIELD, ic ) )
         {
            </font><font class="kw3">PEL_ModuleExplorer</font><font class="text"> </font><font class="kw1">const</font><font class="text">* ee = 
                                      BCs-&gt;BC_explorer( color, FIELD, ic ) ;
            </font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; type = ee-&gt;string_data( </font><font class="string">&quot;type&quot;</font><font class="text"> ) ;
            </font><font class="kw1">if</font><font class="text">( type == </font><font class="string">&quot;Dirichlet&quot;</font><font class="text"> )
            {
               </font><font class="kw1">double</font><font class="text"> h = bFE-&gt;distance_to_adjacent_finite_volume_center() ;
               </font><font class="kw1">double</font><font class="text"> err = FIELD-&gt;DOF_value( LEVEL, n, ic ) - th( ic ) ;
               err_norm += area/h * </font><font class="kw3">PEL</font><font class="text">::sqr( err ) ;
            }
         }
      }
   }
   err_norm = COM-&gt;sum( err_norm ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: compute_shift( </font><font class="kw1">double</font><font class="text">&amp; sol_shift,
                                           </font><font class="kw1">double</font><font class="text">&amp; app_shift )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: compute_shift&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK_INV</font><font class="text">( invariant() ) ;
   
   sol_shift = 0. ;
   app_shift = 0. ;

   </font><font class="kw1">if</font><font class="text">( NULLIFY_INTEGRAL )
   {
      </font><font class="kw1">double</font><font class="text"> w_tot = 0. ;
      </font><font class="kw1">for</font><font class="text">( cFE-&gt;start() ; cFE-&gt;is_valid() ; cFE-&gt;go_next() )
      {
         cFE-&gt;start_IP_iterator( QRP ) ;
         </font><font class="kw1">for</font><font class="text">( ; cFE-&gt;valid_IP() ; cFE-&gt;go_next_IP() )
         {
            </font><font class="kw3">doubleVector</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; dv =
               cFE-&gt;coordinates_of_IP()-&gt;coordinate_vector() ;
            COORDS-&gt;</font><font class="kw2">set</font><font class="text">( dv ) ;
            </font><font class="kw1">double</font><font class="text"> weight = cFE-&gt;weight_of_IP() ;
            </font><font class="kw1">if</font><font class="text">( </font><font class="kw3">FE</font><font class="text">::geometry() == </font><font class="kw3">FE</font><font class="text">::axisymmetrical )
            {
               weight *= dv(0) ;
            }
            w_tot += weight ;
            </font><font class="kw1">double</font><font class="text"> </font><font class="kw1">const</font><font class="text"> val = cFE-&gt;value_at_IP( FIELD, LEVEL ) ;
            </font><font class="kw3">doubleVector</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; theo = SOL-&gt;to_double_vector() ;
            </font><font class="kw1">double</font><font class="text"> </font><font class="kw1">const</font><font class="text"> sol = theo(0) ;
            sol_shift += weight*sol ;
            app_shift += weight*val ;
         }
      }
      sol_shift = COM-&gt;sum( sol_shift ) ;
      app_shift = COM-&gt;sum( app_shift ) ;
      w_tot = COM-&gt;sum( w_tot ) ;
      sol_shift /= w_tot ;
      app_shift /= w_tot ;
   }
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">double
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: max_inter_vertices_distance_of_cells( </font><font class="kw1">void</font><font class="text"> )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: max_inter_vertices_distance_of_cells&quot;</font><font class="text"> ) ;
   </font><font class="kw1">double</font><font class="text"> result = 0. ;
   </font><font class="kw1">for</font><font class="text">( cFE-&gt;start() ; cFE-&gt;is_valid() ; cFE-&gt;go_next() )
   {
      </font><font class="kw1">double</font><font class="text"> h = cFE-&gt;polyhedron()-&gt;inter_vertices_maximum_distance() ;
      </font><font class="kw1">if</font><font class="text">( h &gt; result ) result = h ;      
   }
   result = COM-&gt;max( result ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">double
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: max_equivalent_ball_diameter_of_cells( </font><font class="kw1">void</font><font class="text"> )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: max_equivalent_ball_diameter_of_cells&quot;</font><font class="text"> ) ;
   </font><font class="kw1">double</font><font class="text"> result = 0. ;
   </font><font class="kw1">for</font><font class="text">( cFE-&gt;start() ; cFE-&gt;is_valid() ; cFE-&gt;go_next() )
   {
      </font><font class="kw1">double</font><font class="text"> h = cFE-&gt;polyhedron()-&gt;equivalent_ball_diameter() ;
      </font><font class="kw1">if</font><font class="text">( h &gt; result ) result = h ;      
   }
   result = COM-&gt;max( result ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw3">GE_Point</font><font class="text"> </font><font class="kw1">const</font><font class="text">*
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: D_norm_center(
                                      </font><font class="kw3">GE_Mpolyhedron</font><font class="text"> </font><font class="kw1">const</font><font class="text">* poly ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: D_norm_center&quot;</font><font class="text"> ) ;
   </font><font class="kw3">PEL_CHECK</font><font class="text">( poly != 0 ) ;
   </font><font class="kw3">PEL_CHECK</font><font class="text">( poly-&gt;dimension() == poly-&gt;nb_space_dimensions() ) ;
   
   </font><font class="kw1">static</font><font class="text"> </font><font class="kw3">GE_Point</font><font class="text">* pt_ref =
      </font><font class="kw3">GE_Point</font><font class="text">::create( </font><font class="kw3">PEL_Root</font><font class="text">::object(), poly-&gt;nb_space_dimensions() ) ;
   </font><font class="kw3">GE_Point</font><font class="text"> </font><font class="kw1">const</font><font class="text">* result = poly-&gt;finite_volume_center() ;
   </font><font class="kw1">if</font><font class="text">( result != 0 )
   {
      poly-&gt;apply_inverse_mapping( result, pt_ref ) ;
      </font><font class="kw1">if</font><font class="text">( !poly-&gt;reference_polyhedron()-&gt;contains( pt_ref, -DIST_REF ) )
      {
         result = 0 ;
      }
   }
   </font><font class="kw1">if</font><font class="text">( result == 0 ) result = poly-&gt;center() ;

   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result != 0 ) ;
   </font><font class="kw3">PEL_CHECK_POST</font><font class="text">( result-&gt;nb_coordinates() == poly-&gt;nb_space_dimensions() ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: read_norm( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; norm_name,
                                       NormType&amp; nt, </font><font class="kw1">double</font><font class="text">&amp; exponent,
                                       </font><font class="kw3">PEL_ModuleExplorer</font><font class="text"> </font><font class="kw1">const</font><font class="text">* exp )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: read_norm&quot;</font><font class="text"> ) ;
   
   nt = Invalid ;
   exponent = </font><font class="kw3">PEL</font><font class="text">::bad_double() ;
   
   </font><font class="kw1">if</font><font class="text">( norm_name == </font><font class="string">&quot;Infinity_error_norm&quot;</font><font class="text"> )
   {
      nt = err_Linf ;
   }
   </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( norm_name == </font><font class="string">&quot;Infinity_solution_norm&quot;</font><font class="text"> )
   {
      nt = sol_Linf ;
   }
   </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( norm_name == </font><font class="string">&quot;H1_0_error_norm&quot;</font><font class="text"> )
   {
      nt = err_sW1p ;
      exponent = 2.0 ;
   }
   </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( norm_name == </font><font class="string">&quot;H1_D_error_D_norm&quot;</font><font class="text"> )
   {
      nt = err_H1D ;
   }
   </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( norm_name == </font><font class="string">&quot;H1_Dirichlet_D_error_D_norm&quot;</font><font class="text"> )
   {
      nt = err_H1DirD ;
   }
   </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( norm_name == </font><font class="string">&quot;H1_0_solution_norm&quot;</font><font class="text"> )
   {
      nt = sol_sW1p ;
      exponent = 2.0 ;
   }
   </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( norm_name == </font><font class="string">&quot;H1_0_interpolation_error_norm&quot;</font><font class="text"> )
   {
      nt = eip_sW1p ;
      exponent = 2.0 ;
   }
   </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( norm_name == </font><font class="string">&quot;H1_error_norm&quot;</font><font class="text"> )
   {
      nt = err_W1p ;
      exponent = 2.0 ;
   }
   </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( norm_name == </font><font class="string">&quot;H1_solution_norm&quot;</font><font class="text"> )
   {
      nt = sol_W1p ;
      exponent = 2.0 ;
   }
   </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( norm_name == </font><font class="string">&quot;H1_interpolation_error_norm&quot;</font><font class="text"> )
   {
      nt = eip_W1p ;
      exponent = 2.0 ;
   }
   </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( ( norm_name.length() &gt; 5 ) &amp;&amp; 
            ( norm_name[0] == </font><font class="string">'L'</font><font class="text"> ) )
   {
      </font><font class="kw2">string</font><font class="text"> nn ;
      parse_norm_name( norm_name, </font><font class="string">&quot;L&quot;</font><font class="text">, exponent, nn ) ;
      </font><font class="kw1">if</font><font class="text">( nn == </font><font class="string">&quot;error_norm&quot;</font><font class="text"> )
      {
         nt = err_Lp ;
      }
      </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( nn == </font><font class="string">&quot;error_D_norm&quot;</font><font class="text"> )
      {
         nt = err_LpD ;
      }
      </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( nn == </font><font class="string">&quot;solution_norm&quot;</font><font class="text"> )
      {
         nt = sol_Lp ;
      }
      </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( nn == </font><font class="string">&quot;interpolation_error_norm&quot;</font><font class="text"> )
      {
         nt = eip_Lp ;
      }
   }
   </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( ( norm_name.length() &gt; 5 ) &amp;&amp; 
            ( norm_name.substr( 0, 3 ) == </font><font class="string">&quot;sW1&quot;</font><font class="text"> ) )
   {
      </font><font class="kw2">string</font><font class="text"> nn ;
      parse_norm_name( norm_name, </font><font class="string">&quot;sW1&quot;</font><font class="text">, exponent, nn ) ;
      </font><font class="kw1">if</font><font class="text">( nn == </font><font class="string">&quot;error_norm&quot;</font><font class="text"> )
      {
         nt = err_sW1p ;
      }
      </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( nn == </font><font class="string">&quot;solution_norm&quot;</font><font class="text"> )
      {
         nt = sol_sW1p ;
      }
      </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( nn == </font><font class="string">&quot;interpolation_error_norm&quot;</font><font class="text"> )
      {
         nt = eip_sW1p ;
      }
   }
   </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( ( norm_name.length() &gt; 5 ) &amp;&amp; 
            ( norm_name.substr( 0, 2 ) == </font><font class="string">&quot;W1&quot;</font><font class="text"> ) )
   {
      </font><font class="kw2">string</font><font class="text"> nn ;
      parse_norm_name( norm_name, </font><font class="string">&quot;W1&quot;</font><font class="text">, exponent, nn ) ;
      </font><font class="kw1">if</font><font class="text">( nn == </font><font class="string">&quot;error_norm&quot;</font><font class="text"> )
      {
         nt = err_W1p ;
      }
      </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( nn == </font><font class="string">&quot;solution_norm&quot;</font><font class="text"> )
      {
         nt = sol_W1p ;
      }
      </font><font class="kw1">else</font><font class="text"> </font><font class="kw1">if</font><font class="text">( nn == </font><font class="string">&quot;interpolation_error_norm&quot;</font><font class="text"> )
      {
         nt = eip_W1p ;
      }
   }
   
   </font><font class="kw1">if</font><font class="text">( nt == Invalid )
   {
      </font><font class="kw3">PEL_ASSERT</font><font class="text">( exponent == </font><font class="kw3">PEL</font><font class="text">::bad_index() ) ;
      </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_bad_data_value(
         exp, </font><font class="string">&quot;norms&quot;</font><font class="text">,
         </font><font class="string">&quot;   - \&quot;</font><font class="text">Infinity_solution_norm\</font><font class="string">&quot;\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">Infinity_error_norm\</font><font class="string">&quot;\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">Lp_solution_norm\</font><font class="string">&quot; (with a decent value for p)\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">Lp_interpolation_error_norm\</font><font class="string">&quot; (with a decent value for p)\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">Lp_error_norm\</font><font class="string">&quot; (with a decent value for p)\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">sW1p_solution_norm\</font><font class="string">&quot; (with a decent value for p)\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">sW1p_interpolation_error_norm\</font><font class="string">&quot; (with a decent value for p)\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">sW1p_error_norm\</font><font class="string">&quot; (with a decent value for p)\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">W1p_solution_norm\</font><font class="string">&quot; (with a decent value for p)\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">W1p_interpolation_error_norm\</font><font class="string">&quot; (with a decent value for p)\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">W1p_error_norm\</font><font class="string">&quot; (with a decent value for p)\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">H1_0_error_norm\</font><font class="string">&quot;\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">H1_0_solution_norm\</font><font class="string">&quot;\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">H1_0_interpolation_error_norm\</font><font class="string">&quot;\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">H1_error_norm\</font><font class="string">&quot;\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">H1_solution_norm\</font><font class="string">&quot;\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">H1_interpolation_error_norm\</font><font class="string">&quot;&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">Lp_error_D_norm\</font><font class="string">&quot; (with a decent value for p)\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">H1_D_error_D_norm\</font><font class="string">&quot;\n&quot;
</font><font class="text">         </font><font class="string">&quot;   - \&quot;</font><font class="text">H1_Dirichlet_D_error_D_norm\</font><font class="string">&quot;\n&quot;
</font><font class="text">         ) ;
   }
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: parse_norm_name( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; norm_name,
                                             </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; start,
                                             </font><font class="kw1">double</font><font class="text">&amp; pp, </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text">&amp; end )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw3">PEL_LABEL</font><font class="text">( </font><font class="string">&quot;FE_ComparatorWithAnalytic:: parse_norm_name&quot;</font><font class="text"> ) ;
   
   </font><font class="kw2">size_t</font><font class="text"> nl = norm_name.length() ;
   </font><font class="kw2">size_t</font><font class="text"> sl = start.length() ;
   
   </font><font class="kw1">bool</font><font class="text"> ok = ( nl &gt; sl+1 ) ;
   </font><font class="kw1">if</font><font class="text">( ok )
   {
      </font><font class="kw2">size_t</font><font class="text"> jj = sl + 1 ;
      </font><font class="kw1">do
</font><font class="text">      {
         </font><font class="kw1">if</font><font class="text">( norm_name[jj] == </font><font class="string">'_'</font><font class="text"> ) </font><font class="kw1">break</font><font class="text"> ;
         ++jj ;
      }
      </font><font class="kw1">while</font><font class="text">( jj &lt;= nl ) ;
      ok = ( jj != nl ) ;
      </font><font class="kw1">if</font><font class="text">( ok )
      {
         istringstream iss( norm_name.substr( sl, jj-1 ) ) ;
         ok = ( iss &gt;&gt; pp ) ;
         </font><font class="kw1">if</font><font class="text">( ok )
         {
            end = norm_name.substr( jj+1, nl ) ;
         }
      }
   }
   
   </font><font class="kw1">if</font><font class="text">( pp &lt; 1.0 ) FE_ComparatorWithAnalytic_ERROR:: n4( norm_name, pp ) ; 
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw1">void
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: add_exponent( </font><font class="kw1">double</font><font class="text"> pp )
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">if</font><font class="text">( pp != </font><font class="kw3">PEL</font><font class="text">::bad_double() )
   {
      </font><font class="kw2">size_t</font><font class="text"> idx = idx_of_exponent( pp ) ;
      </font><font class="kw1">if</font><font class="text">( idx == </font><font class="kw3">PEL</font><font class="text">::bad_index() )
      {
         IDX_EXPOS.append( pp ) ;
      }
   }
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw2">size_t
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: nb_exponents( </font><font class="kw1">void</font><font class="text"> ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw1">return</font><font class="text">( IDX_EXPOS.size() ) ;
}

</font><font class="comment">//----------------------------------------------------------------------
</font><font class="kw2">size_t
</font><font class="kw3">FE_ComparatorWithAnalytic</font><font class="text">:: idx_of_exponent( </font><font class="kw1">double</font><font class="text"> pp ) </font><font class="kw1">const
</font><font class="comment">//----------------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw2">size_t</font><font class="text"> result = IDX_EXPOS.index_of( pp, 1.e-8, 1.e-14 ) ;
   </font><font class="kw1">return</font><font class="text">( result ) ;
}

</font><font class="comment">//internal--------------------------------------------------------------
</font><font class="kw1">void</font><font class="text"> 
FE_ComparatorWithAnalytic_ERROR:: n0( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; field_name,
                                      </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; error )
</font><font class="comment">//internal--------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">ostringstream</font><font class="text"> msg ;
   msg &lt;&lt; </font><font class="kw2">endl</font><font class="text"> &lt;&lt; </font><font class="string">&quot;*** FE_ComparatorWithAnalytic:&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
   msg &lt;&lt; </font><font class="string">&quot;    field: \&quot;&quot; &lt;&lt; field_name &lt;&lt; &quot;</font><font class="text">\</font><font class="string">&quot;&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
   msg &lt;&lt; error ;
   </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_plain( msg.str() ) ;
}

</font><font class="comment">//internal--------------------------------------------------------------
</font><font class="kw1">void</font><font class="text"> 
FE_ComparatorWithAnalytic_ERROR:: n1( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; save_name )
</font><font class="comment">//internal--------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">ostringstream</font><font class="text"> msg ;
   msg &lt;&lt; </font><font class="kw2">endl</font><font class="text"> &lt;&lt; </font><font class="string">&quot;*** FE_ComparatorWithAnalytic:&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
   msg &lt;&lt; </font><font class="string">&quot;    the saving name \&quot;&quot; &lt;&lt; save_name &lt;&lt; &quot;</font><font class="text">\</font><font class="string">&quot;&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
   msg &lt;&lt; </font><font class="string">&quot;    is multiply used&quot;</font><font class="text"> ;
   </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_plain( msg.str() ) ;
}

</font><font class="comment">//internal--------------------------------------------------------------
</font><font class="kw1">void</font><font class="text"> 
FE_ComparatorWithAnalytic_ERROR:: n2( </font><font class="kw3">GE_Mpolyhedron</font><font class="text"> </font><font class="kw1">const</font><font class="text">* poly )
</font><font class="comment">//internal--------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">ostringstream</font><font class="text"> msg ;
   msg &lt;&lt; </font><font class="kw2">endl</font><font class="text"> &lt;&lt; </font><font class="string">&quot;*** FE_ComparatorWithAnalytic:&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
   msg &lt;&lt; </font><font class="string">&quot;    the \&quot;</font><font class="text">finite volume center\</font><font class="string">&quot; has not been defined&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
   msg &lt;&lt; </font><font class="string">&quot;    for the following polyhedron:&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
   poly-&gt;print( msg, 4 ) ;
   </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_plain( msg.str() ) ;
}

</font><font class="comment">//internal--------------------------------------------------------------
</font><font class="kw1">void</font><font class="text"> 
FE_ComparatorWithAnalytic_ERROR:: n3( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; fname  )
</font><font class="comment">//internal--------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">ostringstream</font><font class="text"> msg ;
   msg &lt;&lt; </font><font class="kw2">endl</font><font class="text"> &lt;&lt; </font><font class="string">&quot;*** FE_ComparatorWithAnalytic:&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
   msg &lt;&lt; </font><font class="string">&quot;    unable to open file \&quot;&quot; &lt;&lt; fname &lt;&lt; &quot;</font><font class="text">\</font><font class="string">&quot;&quot;</font><font class="text"> ;
   </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_plain( msg.str() ) ;
}

</font><font class="comment">//internal--------------------------------------------------------------
</font><font class="kw1">void</font><font class="text"> 
FE_ComparatorWithAnalytic_ERROR:: n4( </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">string</font><font class="text"> </font><font class="kw1">const</font><font class="text">&amp; norm_name, </font><font class="kw1">double</font><font class="text"> pp )
</font><font class="comment">//internal--------------------------------------------------------------
</font><font class="text">{
   </font><font class="kw2">std</font><font class="text">::</font><font class="kw2">ostringstream</font><font class="text"> msg ;
   msg &lt;&lt; </font><font class="kw2">endl</font><font class="text"> &lt;&lt; </font><font class="string">&quot;*** FE_ComparatorWithAnalytic:&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
   msg &lt;&lt; </font><font class="string">&quot;    the norm of name \&quot;&quot; &lt;&lt; norm_name &lt;&lt; &quot;</font><font class="text">\</font><font class="string">&quot;&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
   msg &lt;&lt; </font><font class="string">&quot;    is associated to L^{&quot;</font><font class="text"> &lt;&lt; pp &lt;&lt; </font><font class="string">&quot;} which is&quot;</font><font class="text"> &lt;&lt; </font><font class="kw2">endl</font><font class="text"> ;
   msg &lt;&lt; </font><font class="string">&quot;    certainly an error&quot;</font><font class="text"> ;
   </font><font class="kw3">PEL_Error</font><font class="text">::object()-&gt;raise_plain( msg.str() ) ;
}

</font>
</pre>
</body>
</html>
